<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');


* { position: relative; box-sizing: border-box; }

html, body {
  font-family: Avenir, sans-serif;
  width: 100%;
  margin: 0;
  padding: 0px;
}


body {
    display: flex;
    justify-content: center;
    align-items: center;
    background: #080302;
    background-image: linear-gradient(45deg, #080302 15%, #330401 100%);
    background-repeat: no-repeat;
    background-size: cover;
    color: #FFFFFF;
}


body.popupOpen .mine { pointer-events: none; }
body:not(.popupOpen) .mine { pointer-events: auto; }

#gsapWrapper {

    display: block;
    position: relative;
    opacity: 0;
    width: 100%;
    visibility: hidden;
    overflow-x: clip;

    #gsapBody {

        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;

        -webkit-perspective: 1000px;
        perspective: 1000px;
        min-height: 100vh;
        overflow-x: clip;
        padding-bottom: 100px;

        #world3d {

            position: relative;
            z-index: 6;
            -webkit-transform-style: preserve-3d;
            transform-style: preserve-3d;
            shape-rendering: crispEdges;
            overflow: visible;
            width: 70%;
            max-width: 600px;
            background-color: #140605AA;
            border: 3px solid #14BDCC;
            outline: 2px solid #FFFFFF;
            border-radius: 15px;
            transform: rotateX(55deg) rotateY(0deg);
            will-change: transform;
            box-shadow: 0px 0px 8px 8px #FFFFFF88;
            margin-top: -100px;

            @media ( height <= 700px ) {
                margin-left: auto;
                margin-right: auto;
            }


            .mine {

                shape-rendering: crispEdges;
                position: relative;
                float: left;
                width: 89px;
                width: calc( ( 100% / 6 ) - 4px );
                aspect-ratio: 1/1;
                margin: 2px;
                cursor: pointer;
                overflow: visible;
                backface-visibility: hidden;
                will-change: transform;

                &.clicked::after {
                    
                    display: block;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    position: absolute;
                    content: attr(data-proximity);
                    left: 0px;
                    top: 0px;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    font-size: 30px;
                    
                    @media ( width <= 600px )  { font-size: 20px; }

                }

                .surface {

                    display: block;
                    position: absolute;
                    left: 0px;
                    top: 0px;
                    z-index: 7;
                    width: 100%;
                    height: 100%;
                    background-color: #160502;
                    border: 3px solid #FFF3;
                    outline: 1px solid transparent;
                    shape-rendering: crispEdges;
                    backface-visibility: hidden;
                    pointer-events: none;
                    will-change: transform;
                    shape-rendering: crispEdges;
									
					@media ( width <= 992px ) { border: 4px solid #FFF3; }

                }
              
                &.clicked:not(.live) {
                    background-color: transparent;
                    outline: 2px solid #FFF1;
                    pointer-events: none;
                    transform: translateZ(0)!important;
                    .surface { display: none; }
                }
                &.clicked.live {
                    background-color: red!important;
                    color: red!important;
                    box-shadow: 0px 0px 8px 6px red;
                    pointer-events: none;
                    transform: translateZ(0)!important;
                    .surface { display: none; }
                }
                &.detected {
                    .surface { background-color: #f29224!important; border-color:#fe8800; color:#f29224!important; }
                }

            }

            #world3dCover {
                display: block;
                position: absolute;
                left: 0px;
                right: 0px;
                top: 0px;
                bottom: 0px;
                background-color: #FF000000;
                z-index: 100;
            }

        }

    }

}


body:not(.detect) {
    .surface { color: #14bdcc; }
    .mine:hover .surface { background-color: inherit; color: #14bdcc; }
}
body.detect {
    .surface { color: #f29224; }
    .mine:hover .surface { background-color: inherit; color: #f29224; }
}

#p00, #p00 .surface { border-top-left-radius: 10px!important; }
#p05, #p05 .surface { border-top-right-radius: 10px!important; }
#p50, #p50 .surface { border-bottom-left-radius: 10px!important; }
#p55, #p55 .surface { border-bottom-right-radius: 10px!important; }





headerWrapper {

    display: block;
    /*position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 2; */
    text-align: center;

    header {

        display: block;
        width: 100%;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
        text-align: left;
        padding: 15px;
			
        font-family: "Black Ops One", system-ui;
        font-optical-sizing: auto;
        font-weight: normal;
        font-variation-settings: "wdth" 100;

        svg { width: 100%; max-width: 500px; }

        hgroup {

            display: block;
            width: 100%;
            max-width: 530px;
            margin-left: auto;
            margin-right: auto;
            text-shadow: 5px 5px 4px #000;

            h1 {
                display: block;
                font-size: 32px;
                line-height: 1em;
                margin: 0px;
                margin-top: -50px;
                padding: 0px;
                padding-bottom: 0px;
                @media ( width <= 600px ) { font-size: 10vw; margin-top: 0px; padding-bottom: 0px; }
            }
            h2 {
                display: block;
                font-family: Arial, Helvetica, sans-serif;
                font-size: 10px;
                font-weight: normal;
                line-height: 1em;
                margin: 0px;
                padding-bottom: 10px;
                a {
                    color: #FFF;
                    text-decoration: none;
                    cursor: pointer;
                    &:hover { color: #FFF; }
                }
            }
            p {
                font-size: 18px;
                margin: 0px;
                padding: 0px;
                text-wrap: nowrap;
                @media ( width <= 600px )  { text-wrap: wrap; }
                span {
                    display: inline-block;
                    line-height: 20px;
                    letter-spacing: 2px;
                    white-space: nowrap;
                    padding-right: 20px;
										&#dataTime { width: 150px; }
                }
            }

        }

    }

}




.vBand {

    display: inline-block;
    position: fixed;
    left: 25vw;
    left: calc( 50vw - 200px );
    top: 0px;
    min-width: 300px;
    height: 100%;
    min-height: 100vh;
    padding: 25px;
    font-family: "Roboto", sans-serif;
    font-family: "Black Ops One", system-ui;
    font-optical-sizing: auto;
    font-weight: normal;
    font-variation-settings: "wdth" 100;

    &.bg { filter: url(#noise); z-index: -1; opacity: 0.1 }
    &.bg2 { filter: url(#noise2); z-index: -1; opacity: 0.1 }

    &.light {
       background-image: linear-gradient( to left, #21040233 10%, #FFF2 50%, #1a040233 90%);
       z-index: 0;
    }
    &.blur {
       background-image: linear-gradient(#33040100 20%, #080302CC 100%);
       backdrop-filter: blur(0.5px);
       z-index: 1;
    }

}

body.popupOpen #popupWrapper {visibility: visible; }
body:not(.popupOpen) #popupWrapper { visibility: hidden; }

#popupWrapper {
 
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    flex-direction: column;
    position: fixed;
    left: 0;
    right: 0;
    top: 0px;
    bottom: 0px;
    z-index: 50;
    width: 100vw;
    font-family: "Black Ops One", system-ui;
    font-size: 16vw;
    font-optical-sizing: auto;
    font-weight: normal;
    font-variation-settings: "wdth" 100;


    #popup {

        display: block;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        flex-direction: column;
        min-height: 50vh;
        padding: 30px;
        background-color: #FFF1;
        border: solid 2px #FFF3;
        backdrop-filter: blur(8px);
        border-radius: 15px;

        span:not(.display) { display: none; }
        div#playAgain {
            font-size: 20px;
            text-decoration: underline;
            cursor: pointer;
        }

    }

}






#directions {

    position: fixed;
    top: 40px;
    right: 0px;
    padding: 15px;
    color: #FFF;
    border-top-left-radius: 15px;
    border-bottom-left-radius: 15px;
    border-right: none;
    z-index: 3;

    
    @media not (pointer: coarse) {
        background-color: #FFF2;
        border: solid 2px #FFF3;
        backdrop-filter: blur(8px);
        padding-top: 30px;
        padding-left: 25px;
        right: -120px;
        transition: right 0.5s;
        #notTouch { display: block; }
        #touch { display: none; }
    }

    @media (pointer: coarse) {
        #notTouch { display: none; }
        #touch {
            display: block;
            text-align: center;

            #touchSwitch {
                display: block;
                display: flex;
                width: 30px;
                height: 160px;
                border-radius: 15px;
                cursor: pointer;
                filter: drop-shadow(0 0 5px #000);

                #toggle {
                    display: block;
                    width: 30px;
                    padding: 5px;
                    padding-top: 15px;
                    padding-bottom: 15px;
                    border-radius: 15px;
                    background-color: #FFFFFF;     
                    transition: all 0.5s;
                    writing-mode: vertical-lr;
                    text-orientation: sideways;

                    &::after {
                        color: #080302;
                        font-family: Arial, Helvetica, sans-serif;
                        font-size: 18px;
                        font-weight: bold;
                    }

                }

            }

        }
    }

    span {

        display: block;
        white-space: nowrap;
        padding-left: 35px;
        margin-top: 15px;
        margin-bottom: 15px;
        line-height: 30px;
        background-position: left center;
        background-repeat: no-repeat;

        &#leftClick { background-image: url('data:image/svg+xml,<svg width="25" height="30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><g fill="%23FFFFFF" stroke="none"><path d="m 7.9,13.4 c 0,-4.3 3.3,-7.8 7.5,-7.8 4.2,0 7.5,3.5 7.5,7.8 v 8.4 c 0,4.3 -3.3,7.8 -7.5,7.8 -4.2,0 -7.5,-3.5 -7.5,-7.8 z M 14.6,7.1 c -5,0.7 -5.2,6 -5.2,6.7 h 5.2 z" /><path d="M 7,6.4 C 7.8,7.2 9,6.1 8.2,5.3 L 6,3.1 C 5.3,2.3 4.1,3.5 4.9,4.3 Z M 12.4,1.2 c -0,-1.1 -1.6,-1.1 -1.7,-0 l -0,3.1 c -0,1.1 1.7,1.1 1.7,0 z M 5.9,10.6 c 1.1,0 1.1,-1.7 0,-1.7 L 2.9,8.9 c -1.1,0 -1.1,1.6 -0,1.7 z" /></g></svg>'); }
        &#rightClick { background-image: url('data:image/svg+xml,<svg width="25" height="30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><g fill="%23FFFFFF" stroke="none"><path d="M 17.1,13.4 C 17.1,9.1 13.8,5.6 9.6,5.6 5.4,5.6 2.1,9.1 2.1,13.4 v 8.4 c 0,4.3 3.3,7.8 7.5,7.8 4.2,0 7.5,-3.5 7.5,-7.8 z M 10.4,7.1 c 5,0.7 5.2,6 5.2,6.7 h -5.2 z" /><path d="M 18,6.4 C 17.2,7.2 16,6.1 16.8,5.3 L 19,3.1 c 0.7,-0.8 1.9,0.4 1.1,1.2 z M 12.6,1.2 c 0,-1.1 1.6,-1.1 1.7,0 v 3.1 c 0,1.1 -1.7,1.1 -1.7,0 z m 6.5,9.4 c -1.1,0 -1.1,-1.7 0,-1.7 h 3 c 1.1,0 1.1,1.6 0,1.7 z" /></g></svg>'); }

    }

    &:hover {
        right: 0px;
    }

}

body:not(.detect) { #touch #touchSwitch { background-color: #14bdcc; #toggle { margin-bottom: auto; &::after { content:"Clear"; } } } }
body.detect { #touch #touchSwitch { background-color: #f29224; #toggle { margin-top: auto; &::after { content:"Detect"; } } } }






#focusInput {
    display: block;
    position: fixed;
    width: 50px;
    top: 50px;
    right: -60px;
}
</style>
<body>
    <div id="gsapWrapper">
    <div id="gsapBody">

        <div class="vBand bg"></div>
        <div class="vBand bg2"></div>
        <div class="vBand light"></div>
        <div class="vBand blur"></div>
        
        <headerWrapper>
            <header>
                <svg xml:space="preserve"  viewBox="0 0 987 223" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
                    <path fill="url(#linearBg)" stroke="#543736" stroke-width="10" stroke-linecap="butt" stroke-linejoin="bevel" d="m 619,5c -60,0 -110,47 -110,107 0,58 50,106 110,106 62,0 110,-48 110,-106C 729,52 680,5 619,5Zm 141,1v 210h 43v -94h 55V 94L 779,6Zm 178,0v 96h -55v 26l 80,88h 19L 981,6ZM 5,6V 48H 73V 6Zm 164,0c -34,0 -59,25 -60,58v 152h 44V 68c 0,-11 9,-20 19,-20H 483C 475,23 450,6 423,6Zm 450,42c 36,0 65,28 65,63 0,35 -29,63 -65,63 -35,0 -64,-28 -64,-63 0,-35 29,-63 64,-63zM 261,90v 126h 44V 90Zm 78,0v 36l 88,90h 53l -83,-84h 26c 28,0 52,-16 60,-42 z" />
                </svg>
                <hgroup>
                    <h1 id="dataTitle">minesweeper</h1>
                    <h2>a <a href="https://codepen.io/challenges/2026/january/3" target="_blank">CODEPEN challenge</a> by <a href="https://codepen.io/ikrprojects" target="_blank">ikrProjects</a></h2>
                    <p><span id="dataDetected">Detected: 0/6</span> <span id="dataClicks">Clicks: 0</span> <span id="dataTime">Time: 0:00</span></p>
                </hgroup>
            </header>
        </headerWrapper>

        <div id="world3d">

            <div id="world3dCover"></div>
                        
            <div class="mine" id="p00"><div class="surface"></div></div>
            <div class="mine" id="p01"><div class="surface"></div></div>
            <div class="mine" id="p02"><div class="surface"></div></div>
            <div class="mine" id="p03"><div class="surface"></div></div>
            <div class="mine" id="p04"><div class="surface"></div></div>
            <div class="mine" id="p05"><div class="surface"></div></div>

            <div class="mine" id="p10"><div class="surface"></div></div>
            <div class="mine" id="p11"><div class="surface"></div></div>
            <div class="mine" id="p12"><div class="surface"></div></div>
            <div class="mine" id="p13"><div class="surface"></div></div>
            <div class="mine" id="p14"><div class="surface"></div></div>
            <div class="mine" id="p15"><div class="surface"></div></div>

            <div class="mine" id="p20"><div class="surface"></div></div>
            <div class="mine" id="p21"><div class="surface"></div></div>
            <div class="mine" id="p22"><div class="surface"></div></div>
            <div class="mine" id="p23"><div class="surface"></div></div>
            <div class="mine" id="p24"><div class="surface"></div></div>
            <div class="mine" id="p25"><div class="surface"></div></div>

            <div class="mine" id="p30"><div class="surface"></div></div>
            <div class="mine" id="p31"><div class="surface"></div></div>
            <div class="mine" id="p32"><div class="surface"></div></div>
            <div class="mine" id="p33"><div class="surface"></div></div>
            <div class="mine" id="p34"><div class="surface"></div></div>
            <div class="mine" id="p35"><div class="surface"></div></div>

            <div class="mine" id="p40"><div class="surface"></div></div>
            <div class="mine" id="p41"><div class="surface"></div></div>
            <div class="mine" id="p42"><div class="surface"></div></div>
            <div class="mine" id="p43"><div class="surface"></div></div>
            <div class="mine" id="p44"><div class="surface"></div></div>
            <div class="mine" id="p45"><div class="surface"></div></div>

            <div class="mine" id="p50"><div class="surface"></div></div>
            <div class="mine" id="p51"><div class="surface"></div></div>
            <div class="mine" id="p52"><div class="surface"></div></div>
            <div class="mine" id="p53"><div class="surface"></div></div>
            <div class="mine" id="p54"><div class="surface"></div></div>
            <div class="mine" id="p55"><div class="surface"></div></div>

        </div>

        <div id="directions">
            <div id="notTouch">
                Mouse Clicks:<br>
                <span id="leftClick">Clear</span>
                <span id="rightClick">Detect</span>
            </div>
            <div id="touch">
                <div id="touchSwitch"><div id="toggle"></div></div>
            </div>
        </div>


    </div>
</div>

<div id="popupWrapper">
    <div id="popup">
        <span id="boom">Boom</span>
        <span id="cleared">Cleared</span>
        <div id="playAgain">Play Again</div>
    </div>
</div>

<input id="focusInput" />




<svg xmlns="http://www.w3.org/2000/svg" role="none" width="0" width="0" style="position:absolute; z-index:5;">
    <defs>

    		<linearGradient id="linearBg"><stop offset="0" stop-color="#1a0301" /><stop offset="1" stop-color="#260401" /></linearGradient>

        <filter id="noise" x="0%" y="0%" width="100%" height="100%">
            <feTurbulence id="turbulence" type="turbulence" baseFrequency="0.1095,0.001" numOctaves="0.5" result="turbulence" seed="6">
                <animate id="noiseAnimate" attributeName="baseFrequency" values="0.1,0.001; 0.1099,0.001; 0.1095,0.001; 0.1099,0.001; 0.1,0.001;" from="0" to="100" dur="8s" repeatCount="indefinite" />
            </feTurbulence>
            <feFlood flood-color="#FFF" result="col" />
            <feComposite in="col" in2="turbulence" operator="in" />
        </filter>

        <filter id="noise2" x="0%" y="0%" width="100%" height="100%">
            <feTurbulence id="turbulence" type="turbulence" baseFrequency="0.1,0.001" numOctaves="1" result="turbulence" seed="3">
                <animate id="noiseAnimate" attributeName="baseFrequency" values="0.1095,0.001; 0.1096,0.001; 0.1,0.001; 0.1096,0.001; 0.1095,0.001;" from="0" to="100" dur="12s" repeatCount="indefinite" />
            </feTurbulence>
             <feFlood flood-color="#FFF" result="col" />
             <feComposite in="col" in2="turbulence" operator="in" />
        </filter>

    </defs>
</svg>
<script>
    gsap.set("#gsapWrapper", { autoAlpha: 1 });


let select = e => document.querySelector(e);
let selectAll = e => document.querySelectorAll(e);

const
body = select('body'),
world3d = select('#world3d'),
world3dCover = select('#world3dCover'),
gsapWrapper = select('#gsapWrapper'),  
dataInfo = select('#dataInfo'),
directions = select('#directions'),
touchSwitch = select('#touchSwitch'),
playAgain = select('#playAgain'),
mines = selectAll(".mine"),
minesMaxNo = 6;

const zeroPad = (num, places) => String(num).padStart(places, '0');

var numberOfClicks = 0,
liveMinesCounter = 0,
minesDetected = 0,
endGame = false,
displayTime = false,
startTime = Math.floor( Date.now() / 1000 ),
tl = gsap.timeline({ repeat: -1, repeatDelay: 0, onUpdate:()=>{

    if( displayTime )
    {
        let currentTime = Math.floor( Date.now() / 1000 );
        let diff = currentTime - startTime;
        let min = Math.floor(diff / 60);
        let sec = diff % 60;
        select("#dataTime").innerHTML = "Time: " + min + ":" + zeroPad(sec,2);
    }

}, defaults:{ duration: 1 }});


init();
playAgain.addEventListener("click", (event) => {

    gsap.set( world3dCover, { transform: "translateZ(15px)", transformOrigin: "0% 0%" });

    focusOut();
 
    numberOfClicks = 0;
    liveMinesCounter = 0;
    minesDetected = 0;
    endGame = false;

    body.classList.remove("detect");
    select("#dataTime").innerHTML = "Time: 0:00";
    
    mines.forEach( ( mine ) => {
        mine.classList.remove("clicked");
        mine.classList.remove("detected");
        mine.classList.remove("live");
        gsap.set( mine, { attr: { "data-proximity": "" } });
        gsap.set( mine, { transform: "translateZ(0px)", transformOrigin: "0% 0%" });
    });
    displayData();
    init();

});

function init() {
    
    /* setup startup requirements */
    body.classList.remove("popupOpen");
    select("#boom").classList.remove('display');
    select("#cleared").classList.remove('display');

    /* add live mines */
    mines.forEach( ( mine, i ) => {

        if( i === mines.length - 1)
        {
            liveMinesCounter = 0;   
            while( minesMaxNo > liveMinesCounter )
            {
                let thisMine =  mines[gsap.utils.random( 0,35,1 )];
                let targetId = "#"+thisMine.getAttribute("id");
                if( !select(targetId).classList.contains('live') )
                {
                    select(targetId).classList.add('live');
                    liveMinesCounter++;
                }
            }

        }
    
    });

    /* glow animation */
    animateMines();

}


touchSwitch.addEventListener("click", (event) => {
	if( numberOfClicks > 0 )
	{
		body.classList.toggle("detect");
		document.activeElement.blur();
	}
});


/* add eventListeners to each mine */
mines.forEach( ( mine ) => {

	mine.addEventListener("click", (event) => {

			if( body.classList.contains("detect") )
			{
				event.preventDefault();
				detectMine( mine );
				return false;
			}
			else
				clickMine( mine );

	});
	
	if( !window.matchMedia("(pointer: coarse)").matches )
	{
			mine.addEventListener("mouseover", (event) => { glowMine( mine ); });
			mine.addEventListener("contextmenu", (event) => {
				event.preventDefault();
				detectMine( mine );
				return false;
			});
	}

});


/* receding glow trail animation */
function animateMines() {

    focusOut();

    const mineColors = [ "#14bdcc", "#f29224", "#FF0000", "#9cfc1e", "#ffe878", "#FFFFFF" ];
	const triggerMap = [ "#p00", "#p01", "#p02", "#p03", "#p04", "#p05", "#p15", "#p25", "#p35", "#p45", "#p55", "#p54", "#p53", "#p52", "#p51", "#p50", "#p40", "#p30", "#p20", "#p10", "#p11", "#p12", "#p13", "#p14", "#p24", "#p34", "#p44", "#p43", "#p42", "#p41", "#p31", "#p21", "#p22", "#p23", "#p33", "#p32" ]; 
    const triggerMapA = [ "#p00", "#p01", "#p02", "#p03", "#p04", "#p05", "#p15", "#p25", "#p35", "#p45", "#p44", "#p43", "#p42", "#p41",  "#p31", "#p21", "#p22", "#p23" ];   
    const triggerMapB = [ "#p55", "#p54", "#p53", "#p52", "#p51", "#p50", "#p40", "#p30", "#p20", "#p10", "#p11", "#p12", "#p13", "#p14", "#p24", "#p34" , "#p33", "#p32" ]; 
    const triggerMapC = [ "#p00", "#p01", "#p02", "#p03", "#p04", "#p05", "#p15", "#p14", "#p13", "#p12", "#p11", "#p10", "#p20", "#p21", "#p22", "#p23", "#p24", "#p25", "#p35", "#p34", "#p33", "#p32", "#p31", "#p30", "#p40", "#p41", "#p42", "#p43", "#p44", "#p45", "#p55", "#p54", "#p53", "#p52", "#p51", "#p50" ];
    const triggerMapD = [ "#p00", "#p01", "#p10", "#p20", "#p11", "#p02", "#p03", "#p12", "#p21", "#p30", "#p40", "#p31", "#p22", "#p13", "#p04", "#p05", "#p50", "#p51", "#p41", "#p32", "#p23", "#p14", "#p42", "#p33", "#p24", "#p15", "#p25", "#p34", "#p43", "#p52", "#p53", "#p44", "#p35", "#p45", "#p54", "#p55" ];


    gsap.set( world3dCover, { transform: "translateZ(15px)", transformOrigin: "0% 0%" });

    let n = getRandomIntInclusive(1,4);
    let cIndex1 = getRandomIntInclusive(0,3);
    let cIndex2 = getRandomIntInclusive(0,3);
    let cIndex3 = getRandomIntInclusive(0,3);

    switch( n )
     {

        case 1:
        triggerMap.forEach( ( mine, i ) => { 
            setTimeout(function() {
                glowMine( select(mine),mineColors[cIndex1] );
                if( i === mines.length - 1)
                    gsap.timeline()
                    .delay(0.5)
                    .set( world3dCover, { duration: 0.85, transform: "translateZ(0px)", transformOrigin: "0% 0%" });
            }, 50 * i);
        });
        break;

        case 2:
        triggerMapA.forEach( ( mine, i ) => {
        let mine2 = triggerMapB[i];
            setTimeout(function() {
                glowMine( select(mine),mineColors[cIndex2] );
                glowMine( select(mine2),mineColors[cIndex3] );
                if( i === triggerMapA.length - 1)
                    gsap.timeline()
                    .delay(0.25)
                    .set( world3dCover, { duration: 0.85, transform: "translateZ(0px)", transformOrigin: "0% 0%" });
            }, 100 * i);
        });
        break;
        
        case 3:
        triggerMapC.forEach( ( mine, i ) => { 
            setTimeout(function() {
                glowMine( select(mine),mineColors[cIndex1] );
                if( i === mines.length - 1)
                    gsap.timeline()
                    .delay(0.5)
                    .set( world3dCover, { duration: 0.85, transform: "translateZ(0px)", transformOrigin: "0% 0%" });
            }, 50 * i);
        });
        break;
        
        case 4:
        triggerMapD.forEach( ( mine, i ) => { 
            setTimeout(function() {
                glowMine( select(mine),mineColors[cIndex1] );
                if( i === mines.length - 1)
                    gsap.timeline()
                    .delay(0.5)
                    .set( world3dCover, { duration: 0.85, transform: "translateZ(0px)", transformOrigin: "0% 0%" });
            }, 50 * i);
        });
        break;

    }

    focusOut();

}

function detectMine( mine ) {

    if( numberOfClicks > 0 )
    {
        mine.classList.toggle("detected");
        focusOut();
        numberOfClicks++;
        displayData();
    }

}


function clickMine( mine ) {

    let proximityCounter, rowStart, rowEnd, colStart, colEnd;

    mine.classList.add("clicked");
    numberOfClicks++;
    if( numberOfClicks == 1 )
    {
        
        startTime = Math.floor( Date.now() / 1000 );
        displayTime = true;

        /* first click swap live mine with inactive one */
        if( mine.classList.contains('live') )
        {
            liveMinesCounter = liveMinesCounter - 1;   
            while( minesMaxNo > liveMinesCounter )
            {
                let thisMine =  mines[gsap.utils.random( 0,35,1 )];
                let targetId = "#"+thisMine.getAttribute("id");
                if( !select(targetId).classList.contains('live') )
                {
                    select(targetId).classList.add('live');
                    liveMinesCounter++;
                }
            }
            mine.classList.remove('live');
        }

        /* go through all mines and calculate their adjacent active mines */
        mines.forEach( ( mine ) => {

            gsap.set( mine, { attr: { "data-proximity": "" }} );
            if( !mine.classList.contains('live') )
            {

                let thisId = mine.id;
                let thisRow = parseInt(thisId[1]);
                let thisCol = parseInt(thisId[2]);

                proximityCounter = 0;
                rowStart = thisRow - 1;
                rowStart = gsap.utils.clamp(0,5,rowStart);
                rowEnd = thisRow + 1;
                rowEnd = gsap.utils.clamp(0,5,rowEnd);

                for( let r = rowStart; r <= rowEnd; r++ )
                {

                    colStart = thisCol - 1;
                    colStart = gsap.utils.clamp(0,5,colStart);
                    colEnd = thisCol + 1;
                    colEnd = gsap.utils.clamp(0,5,colEnd);

                    for( let c = colStart; c <= colEnd; c++ )
                    {
                        if( ( r != thisRow ) || ( c != thisCol ) )
                        {
                            if( select("#p"+r+c).classList.contains('live') )
                                proximityCounter++;
                        }
                    }

                }

                if( proximityCounter > 0 )
                    gsap.set( mine, { attr: { "data-proximity": proximityCounter }} );

            }

        });
                
        proximityClear( mine );

    }
    else
    {

        /* live mine clicked - end game and disable user entry */
        if( mine.classList.contains('live') )
        {
            displayTime = false;
            endGame = true;
            gsap.set( world3dCover, { transform: "translateZ(15px)", transformOrigin: "0% 0%" });
            body.classList.add("popupOpen");
            select("#boom").classList.add('display');
            select("#cleared").classList.remove('display');
        }
        else
            proximityClear( mine );
                
    }

    displayData();

}


function glowMine( mine, newColor="#14bdcc" ) {

    let surface = mine.querySelector(".surface");
    //let oldColor = gsap.getProperty(surface,"color");
    let oldColor = "#14bdcc";
    gsap.timeline({ onComplete: ()=> { gsap.set( surface, { color: oldColor }) }, defaults:{duration: 0.5} })
    .set( surface, { color: newColor } )
    .to( mine, { transform: "translateZ(10px)", transformOrigin: "0% 0%" })
    .fromTo( surface, { filter: "brightness(1.5)", boxShadow: "0px 0px 8px 6px" }, { filter: "brightness(1)", boxShadow: "0px 0px 0px 0px" }, "<");

}


/* update data display information and end game on completion */
function displayData() {

    let displayDetected = 0;
    let displayClicked = 0;

    mines.forEach( ( mine ) => {
			
			if( mine.classList.contains("clicked") )
            displayClicked++;
			else if( mine.classList.contains("detected") )
            displayDetected++;
			
        
    })

    if( displayClicked == 30 )
    {

        if( displayDetected != 6 )
        {
            mines.forEach( ( mine ) => {
                if( mine.classList.contains("live") )
                    mine.classList.add("detected");
            })
            displayDetected = 6;
        }

        displayTime = false;
        if( !endGame )
        {
            gsap.set( world3dCover, { transform: "translateZ(15px)", transformOrigin: "0% 0%" });
            body.classList.add("popupOpen");
            select("#boom").classList.remove('display');
            select("#cleared").classList.add('display');
        }
    }

    select("#dataDetected").innerHTML = "Detected: " + displayDetected + "/"+ minesMaxNo;
    select("#dataClicks").innerHTML = "Clicks: " + numberOfClicks;
	
    focusOut();

}

function focusOut() {
    
    document.getElementById("focusInput").readOnly = false;
    document.getElementById("focusInput").focus();
    document.getElementById("focusInput").readOnly = true;
    document.getElementById("focusInput").blur();
    document.getElementById("focusInput").readOnly = false;

}



function proximityClear( mine ) {

    let thisId = mine.id;
    let thisRow = parseInt(thisId[1]);
    let thisCol = parseInt(thisId[2]);

    let rowStart = thisRow - 1;
    rowStart = gsap.utils.clamp(0,5,rowStart);
    let rowEnd = thisRow + 1;
    rowEnd = gsap.utils.clamp(0,5,rowEnd);

    for( let r = rowStart; r <= rowEnd; r++ )
    {

        let colStart = thisCol - 1;
        colStart = gsap.utils.clamp(0,5,colStart);
        let colEnd = thisCol + 1;
        colEnd = gsap.utils.clamp(0,5,colEnd);

        for( let c = colStart; c <= colEnd; c++ )
        {
            if( ( r == thisRow ) || ( c == thisCol ) )
            {
                let target = select("#p"+r+c);
                if( !target.classList.contains('clicked') && !target.classList.contains('live') )
                {
                    let proximityCounter = target.getAttribute('data-proximity');
                    if( !proximityCounter )
                        target.classList.add('clicked');
                }
            }
        }

    }

    blankProximityClear(4);

}


function blankProximityClear( iteration ) {

    let clickCounter = 0;

    mines.forEach( ( mine ) => {

        if( mine.classList.contains('clicked') && ( mine.getAttribute('data-proximity') == "" ) )
        {

            let thisId = mine.id;
            let thisRow = parseInt(thisId[1]);
            let thisCol = parseInt(thisId[2]);

            let rowStart = thisRow - 1;
            rowStart = gsap.utils.clamp(0,5,rowStart);
            let rowEnd = thisRow + 1;
            rowEnd = gsap.utils.clamp(0,5,rowEnd);

            for( let r = rowStart; r <= rowEnd; r++ )
            {

                let colStart = thisCol - 1;
                colStart = gsap.utils.clamp(0,5,colStart);
                let colEnd = thisCol + 1;
                colEnd = gsap.utils.clamp(0,5,colEnd);

                for( let c = colStart; c <= colEnd; c++ )
                {
                    let target = select("#p"+r+c);
                    if( !target.classList.contains('clicked') )
                    {
                        target.classList.add('clicked');
                        clickCounter++;
                    }
                }

            }

        }

    });

    if( ( clickCounter > 0 ) && ( iteration > 0 ) )
        blankProximityClear( iteration-- );

}


gsapWrapper.addEventListener( 'mousemove', onMouseMove );
function onMouseMove ( e ) {
	
	// change rotation on mouse move
	const
	minPointX = gsapWrapper.offsetWidth / 2,
	sidesZ = ( minPointX - e.clientX ) / gsapWrapper.offsetWidth,
	world3dZAngle = parseInt( 20 * sidesZ ) - 10;

	gsap.to( world3d, 4, { transform: "rotateX(55deg) rotateY(0deg) rotateZ("+world3dZAngle+"deg)", transformOrigin: "50% 50%" } );

}


function getRandomIntInclusive(min, max) {
    const minCeiled = Math.ceil(min);
    const maxFloored = Math.floor(max);
    return Math.floor(Math.random() * (maxFloored - minCeiled + 1) + minCeiled);
}
</script>
</body>
</html>