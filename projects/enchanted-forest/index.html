<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enchanted Forest Â· Realm of the Fae</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Garamond', 'Times New Roman', serif;
            background-color: #0a1420;
            color: #e0d8c0;
        }
        #realm-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 50;
            background: rgba(30, 20, 40, 0.7);
            backdrop-filter: blur(12px);
            border: 2px solid #b89e7b;
            border-radius: 60px;
            padding: 12px 32px;
            display: flex;
            gap: 40px;
            border-left: 6px solid #c6a57a;
            box-shadow: 0 0 40px rgba(200, 150, 100, 0.3);
            pointer-events: none;
            font-family: 'Cinzel', serif;
        }
        .realm-item {
            display: flex;
            flex-direction: column;
        }
        .realm-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            color: #d4b68a;
            letter-spacing: 2px;
        }
        .realm-value {
            font-size: 1.5rem;
            font-weight: 600;
            background: linear-gradient(135deg, #f0e6d2, #c6a57a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        #magic-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(40, 25, 45, 0.8);
            backdrop-filter: blur(16px);
            border: 2px solid #9b8a6b;
            border-radius: 50px;
            padding: 20px 32px;
            z-index: 50;
            border-right: 6px solid #d4a56e;
            min-width: 260px;
            box-shadow: 0 15px 35px rgba(80, 40, 20, 0.5);
        }
        .magic-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1rem;
            border-bottom: 1px solid #5a4a3a;
            padding-bottom: 5px;
        }
        .magic-label {
            color: #d4b68a;
        }
        .magic-value {
            font-weight: 600;
            color: #f0dbb0;
        }
        .pulse-fae {
            width: 14px;
            height: 14px;
            background: #ffcc99;
            border-radius: 50%;
            box-shadow: 0 0 30px #ffaa66;
            animation: fae-pulse 3s infinite;
        }
        @keyframes fae-pulse {
            0% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.4); background: #ffe0aa; }
            100% { opacity: 0.5; transform: scale(1); }
        }
        #environment-glow {
            position: absolute;
            bottom: 30px;
            left: 30px;
            background: rgba(25, 35, 20, 0.7);
            backdrop-filter: blur(8px);
            border: 2px solid #6b8a5a;
            border-radius: 40px;
            padding: 12px 28px;
            z-index: 50;
            border-left: 4px solid #a7c957;
            color: #e0e6b0;
        }
        .glow-icon {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #a7c957;
            border-radius: 50%;
            margin-right: 8px;
            box-shadow: 0 0 15px #c6df75;
        }
        #lore-stats {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(45, 30, 40, 0.8);
            backdrop-filter: blur(8px);
            border: 2px solid #b89e7b;
            border-radius: 40px;
            padding: 16px 28px;
            z-index: 50;
            text-align: right;
            border-bottom: 4px solid #d4a56e;
        }
        .glow-number {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f0dbb0, #d4b68a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <div id="realm-panel">
        <div class="realm-item">
            <span class="realm-label">realm</span>
            <span class="realm-value">AELDWOOD</span>
        </div>
        <div class="realm-item">
            <span class="realm-label">season</span>
            <span class="realm-value">ETERNAL SPRING</span>
        </div>
        <div class="realm-item">
            <span class="realm-label">moon phase</span>
            <span class="realm-value" id="moon-phase">WAXING</span>
        </div>
    </div>

    <div id="magic-panel">
        <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 16px;">
            <span class="pulse-fae"></span>
            <span style="font-weight: 600; font-size: 1.3rem;">âœ¨ ARCANE SIGNATURES</span>
        </div>
        <div class="magic-row">
            <span class="magic-label">ambient magic</span>
            <span class="magic-value" id="ambient-magic">8.4 thaums</span>
        </div>
        <div class="magic-row">
            <span class="magic-label">fae activity</span>
            <span class="magic-value">HIGH</span>
        </div>
        <div class="magic-row">
            <span class="magic-label">will-o-wisps</span>
            <span class="magic-value" id="wisp-count">23</span>
        </div>
        <div class="magic-row">
            <span class="magic-label">ancient wards</span>
            <span class="magic-value">INTACT</span>
        </div>
    </div>

    <div id="environment-glow">
        <span class="glow-icon"></span> <span>bioluminescent fungi Â· glowing moss Â· spirit lanterns</span>
    </div>

    <div id="lore-stats">
        <div style="font-size:1rem;">ðŸ“œ LORE DISCOVERED</div>
        <div class="glow-number">147<span style="font-size:1rem;"> fragments</span></div>
        <div style="font-size:0.8rem;">elven script Â· druidic symbols</div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';
        
        // --- Scene setup ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a1a2a);
        scene.fog = new THREE.FogExp2(0x0a1a2a, 0.008);
        
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 200);
        camera.position.set(15, 8, 25);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);
        
        const labelRenderer = new CSS2DRenderer();
        labelRenderer.setSize(window.innerWidth, window.innerHeight);
        labelRenderer.domElement.style.position = 'absolute';
        labelRenderer.domElement.style.top = '0';
        labelRenderer.domElement.style.left = '0';
        labelRenderer.domElement.style.pointerEvents = 'none';
        document.body.appendChild(labelRenderer.domElement);
        
        // --- Controls ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.3;
        controls.maxPolarAngle = Math.PI / 2.2;
        controls.minDistance = 10;
        controls.maxDistance = 60;
        
        // --- Lighting (moonlight + ambient) ---
        const ambient = new THREE.AmbientLight(0x404860);
        scene.add(ambient);
        
        const moonLight = new THREE.DirectionalLight(0xcce0ff, 0.6);
        moonLight.position.set(-10, 20, 15);
        moonLight.castShadow = true;
        moonLight.shadow.mapSize.width = 1024;
        moonLight.shadow.mapSize.height = 1024;
        const d = 30;
        moonLight.shadow.camera.left = -d;
        moonLight.shadow.camera.right = d;
        moonLight.shadow.camera.top = d;
        moonLight.shadow.camera.bottom = -d;
        moonLight.shadow.camera.near = 1;
        moonLight.shadow.camera.far = 50;
        scene.add(moonLight);
        
        // Colored point lights for magic glow
        const colors = [0x88aaff, 0xffaa88, 0xaacc88, 0xffccaa];
        for (let i = 0; i < 8; i++) {
            const light = new THREE.PointLight(colors[Math.floor(Math.random() * colors.length)], 0.5, 15);
            light.position.set(
                (Math.random() - 0.5) * 25,
                2 + Math.random() * 5,
                (Math.random() - 0.5) * 25
            );
            scene.add(light);
        }
        
        // --- Ground (forest floor) ---
        const groundGeo = new THREE.CircleGeometry(40, 32);
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x2a3a1a, roughness: 0.8 });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = -0.5;
        ground.receiveShadow = true;
        scene.add(ground);
        
        // --- Enchanted trees ---
        function createEnchantedTree(x, z, size = 1.0) {
            const group = new THREE.Group();
            
            // Trunk (twisted)
            const trunkGeo = new THREE.CylinderGeometry(0.4 * size, 0.6 * size, 3 * size, 6);
            const trunkMat = new THREE.MeshStandardMaterial({ color: 0x6b4e3a, emissive: 0x221100 });
            const trunk = new THREE.Mesh(trunkGeo, trunkMat);
            trunk.position.y = 1.5 * size;
            trunk.castShadow = true;
            trunk.receiveShadow = true;
            group.add(trunk);
            
            // Glowing leaves (multiple spheres)
            const leafMat = new THREE.MeshStandardMaterial({ color: 0x88aa55, emissive: 0x224411 });
            for (let i = 0; i < 5; i++) {
                const leafGeo = new THREE.SphereGeometry(0.3 * size, 5);
                const leaf = new THREE.Mesh(leafGeo, leafMat);
                leaf.position.set(
                    (Math.random() - 0.5) * 1.2 * size,
                    2.8 * size + Math.random() * 1.0 * size,
                    (Math.random() - 0.5) * 1.2 * size
                );
                leaf.castShadow = true;
                group.add(leaf);
            }
            
            // Floating lights around tree
            const lightCount = 6;
            for (let i = 0; i < lightCount; i++) {
                const lightGeo = new THREE.SphereGeometry(0.1 * size, 4);
                const lightMat = new THREE.MeshStandardMaterial({ color: 0xffdd99, emissive: 0x442200 });
                const lightBall = new THREE.Mesh(lightGeo, lightMat);
                const angle = (i / lightCount) * Math.PI * 2;
                const radius = 1.5 * size;
                lightBall.position.set(
                    Math.cos(angle) * radius,
                    2.0 * size + Math.sin(angle * 2) * 0.5,
                    Math.sin(angle) * radius
                );
                group.add(lightBall);
            }
            
            group.position.set(x, -0.5, z);
            return group;
        }
        
        // Place trees in a ring
        for (let i = 0; i < 30; i++) {
            const angle = (i / 30) * Math.PI * 2;
            const radius = 8 + Math.random() * 5;
            const x = Math.cos(angle) * radius;
            const z = Math.sin(angle) * radius;
            const tree = createEnchantedTree(x, z, 0.8 + Math.random() * 0.4);
            scene.add(tree);
        }
        
        // Add some random trees
        for (let i = 0; i < 20; i++) {
            const x = (Math.random() - 0.5) * 30;
            const z = (Math.random() - 0.5) * 30;
            if (Math.sqrt(x*x + z*z) < 5) continue; // keep center clear
            const tree = createEnchantedTree(x, z, 0.6 + Math.random() * 0.6);
            scene.add(tree);
        }
        
        // --- Glowing mushrooms ---
        const mushroomGroup = new THREE.Group();
        for (let i = 0; i < 40; i++) {
            const x = (Math.random() - 0.5) * 30;
            const z = (Math.random() - 0.5) * 30;
            
            const stemGeo = new THREE.CylinderGeometry(0.1, 0.15, 0.4);
            const stemMat = new THREE.MeshStandardMaterial({ color: 0xeeddcc });
            const stem = new THREE.Mesh(stemGeo, stemMat);
            stem.position.set(x, -0.3, z);
            stem.castShadow = true;
            stem.receiveShadow = true;
            scene.add(stem);
            
            const capGeo = new THREE.ConeGeometry(0.25, 0.2, 6);
            const capMat = new THREE.MeshStandardMaterial({ color: 0xffaa88, emissive: 0x442200 });
            const cap = new THREE.Mesh(capGeo, capMat);
            cap.position.set(x, -0.05, z);
            cap.castShadow = true;
            scene.add(cap);
        }
        
        // --- Will-o-wisps (floating glowing orbs) ---
        const wisps = [];
        const wispCount = 15;
        
        for (let i = 0; i < wispCount; i++) {
            const wispGeo = new THREE.SphereGeometry(0.2, 6);
            const colors = [0xffaa88, 0x88ffaa, 0xaaccff, 0xffccaa];
            const wispMat = new THREE.MeshStandardMaterial({ 
                color: colors[Math.floor(Math.random() * colors.length)],
                emissive: 0x442200,
                transparent: true,
                opacity: 0.9
            });
            const wisp = new THREE.Mesh(wispGeo, wispMat);
            
            wisp.position.set(
                (Math.random() - 0.5) * 20,
                2 + Math.random() * 4,
                (Math.random() - 0.5) * 20
            );
            
            wisp.userData = {
                angle: Math.random() * Math.PI * 2,
                radius: 0.5 + Math.random() * 1.5,
                speed: 0.01 + Math.random() * 0.02,
                heightOffset: Math.random() * Math.PI * 2,
                baseY: wisp.position.y
            };
            
            scene.add(wisp);
            wisps.push(wisp);
            
            // Add glow sprite
            const canvas = document.createElement('canvas');
            canvas.width = 32;
            canvas.height = 32;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createRadialGradient(16,16,0,16,16,16);
            grad.addColorStop(0, 'rgba(255,200,150,1)');
            grad.addColorStop(0.7, 'rgba(255,150,100,0.3)');
            grad.addColorStop(1, 'rgba(255,100,50,0)');
            ctx.fillStyle = grad;
            ctx.fillRect(0,0,32,32);
            const spriteMap = new THREE.CanvasTexture(canvas);
            const spriteMat = new THREE.SpriteMaterial({ map: spriteMap, blending: THREE.AdditiveBlending });
            const sprite = new THREE.Sprite(spriteMat);
            sprite.scale.set(0.8, 0.8, 1);
            wisp.add(sprite);
        }
        
        // --- Ancient stone circle (standing stones) ---
        for (let i = 0; i < 8; i++) {
            const angle = (i / 8) * Math.PI * 2;
            const radius = 7;
            const x = Math.cos(angle) * radius;
            const z = Math.sin(angle) * radius;
            
            const stoneGeo = new THREE.BoxGeometry(0.8, 2.5 + Math.sin(i)*0.5, 0.6);
            const stoneMat = new THREE.MeshStandardMaterial({ color: 0x7a6a5a, emissive: 0x221100 });
            const stone = new THREE.Mesh(stoneGeo, stoneMat);
            stone.position.set(x, 0.75, z);
            stone.castShadow = true;
            stone.receiveShadow = true;
            scene.add(stone);
            
            // Runic glow
            const runeGeo = new THREE.SphereGeometry(0.1, 3);
            const runeMat = new THREE.MeshStandardMaterial({ color: 0xaaccff, emissive: 0x224466 });
            for (let r = 0; r < 3; r++) {
                const rune = new THREE.Mesh(runeGeo, runeMat);
                rune.position.set(x + (Math.random()-0.5)*0.5, 1.5 + r*0.5, z + 0.4);
                scene.add(rune);
            }
        }
        
        // --- Centerpiece: ancient tree spirit ---
        const spiritGroup = new THREE.Group();
        spiritGroup.position.set(0, -0.5, 0);
        
        const spiritTrunk = new THREE.CylinderGeometry(1.0, 1.5, 4, 8);
        const spiritMat = new THREE.MeshStandardMaterial({ color: 0x8b6b4a, emissive: 0x332211 });
        const trunk = new THREE.Mesh(spiritTrunk, spiritMat);
        trunk.position.y = 2;
        trunk.castShadow = true;
        trunk.receiveShadow = true;
        spiritGroup.add(trunk);
        
        // Glowing heart
        const heartGeo = new THREE.SphereGeometry(0.5);
        const heartMat = new THREE.MeshStandardMaterial({ color: 0xffaa88, emissive: 0x552200 });
        const heart = new THREE.Mesh(heartGeo, heartMat);
        heart.position.y = 2.5;
        heart.position.z = 0.6;
        spiritGroup.add(heart);
        
        scene.add(spiritGroup);
        
        // Spirit label
        const spiritDiv = document.createElement('div');
        spiritDiv.textContent = 'ðŸŒ³ ANCIENT SPIRIT';
        spiritDiv.style.background = '#2a3a1a';
        spiritDiv.style.color = '#d4b68a';
        spiritDiv.style.border = '2px solid #b89e7b';
        spiritDiv.style.borderRadius = '30px';
        spiritDiv.style.padding = '4px 16px';
        const spiritLabel = new CSS2DObject(spiritDiv);
        spiritLabel.position.set(0, 4.5, 0);
        scene.add(spiritLabel);
        
        // --- Animate ---
        let time = 0;
        
        function animate() {
            requestAnimationFrame(animate);
            
            time += 0.01;
            
            // Move wisps
            wisps.forEach(wisp => {
                const data = wisp.userData;
                data.angle += data.speed;
                wisp.position.x += Math.cos(data.angle) * 0.02;
                wisp.position.z += Math.sin(data.angle) * 0.02;
                wisp.position.y = data.baseY + Math.sin(time * 2 + data.heightOffset) * 0.5;
            });
            
            // Update displays
            document.getElementById('ambient-magic').innerText = (8.4 + Math.sin(time)*0.3).toFixed(1) + ' thaums';
            document.getElementById('wisp-count').innerText = 23 + Math.floor(Math.sin(time*2)*3);
            document.getElementById('moon-phase').innerText = ['WAXING', 'FULL', 'WANING'][Math.floor(time*0.1) % 3];
            
            controls.update();
            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
        }
        
        animate();
        
        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>