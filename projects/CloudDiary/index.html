<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Diary ‚òÅÔ∏è</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --dawn-gradient: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            --morning-gradient: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            --noon-gradient: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
            --afternoon-gradient: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%);
            --dusk-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --night-gradient: linear-gradient(135deg, #0c3483 0%, #a2b6df 100%, #6b8cce 100%, #a2b6df 100%);
            --midnight-gradient: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
        }

        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            overflow: hidden;
            color: #333;
            transition: background 2s ease;
        }

        /* Sky Background */
        #sky {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            transition: background 2s ease;
        }

        /* Stars for night */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
        }

        /* Sun/Moon */
        #celestial-body {
            position: fixed;
            top: 50px;
            right: 80px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            z-index: -1;
            transition: all 2s ease;
            box-shadow: 0 0 40px rgba(255, 255, 100, 0.6);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        h1 {
            font-family: 'Gochi Hand', cursive;
            font-size: 3.2rem;
            color: white;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background-color: rgba(255, 255, 255, 0.85);
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            background-color: white;
        }

        .btn i {
            font-size: 1.2rem;
        }

        .time-controls {
            display: flex;
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 50px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .time-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .time-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .time-btn.active {
            background-color: #4a6fa5;
            color: white;
        }

        .main-content {
            display: flex;
            flex: 1;
            gap: 30px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }

        .diary-section {
            flex: 1;
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .clouds-section {
            flex: 2;
            position: relative;
            overflow: hidden;
            border-radius: 20px;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #4a6fa5;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 20px;
            border: 2px solid #e0e7ff;
            border-radius: 15px;
            font-size: 1.1rem;
            font-family: 'Poppins', sans-serif;
            resize: none;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #8a9bc9;
        }

        .char-count {
            text-align: right;
            color: #777;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .mood-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .mood-btn {
            padding: 8px 16px;
            border-radius: 50px;
            border: 2px solid #e0e7ff;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .mood-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .mood-btn.active {
            border-color: #8a9bc9;
            background-color: #e8edff;
            font-weight: 600;
        }

        .cloud {
            position: absolute;
            background-color: white;
            border-radius: 50px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            cursor: move;
            user-select: none;
            transition: transform 0.3s ease;
            max-width: 300px;
            min-width: 200px;
            z-index: 1;
        }

        .cloud:hover {
            transform: scale(1.03);
            z-index: 10;
        }

        .cloud-content {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .cloud-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #777;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        .cloud-mood {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .cloud-controls {
            display: flex;
            gap: 8px;
        }

        .cloud-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #777;
            transition: color 0.3s;
            font-size: 0.9rem;
        }

        .cloud-btn:hover {
            color: #4a6fa5;
        }

        .empty-clouds {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.2rem;
            width: 80%;
        }

        .empty-clouds i {
            font-size: 4rem;
            margin-bottom: 15px;
            display: block;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 0.9rem;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }

        /* Cloud shapes */
        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background-color: white;
            border-radius: 50%;
            z-index: -1;
        }

        .cloud::before {
            width: 60px;
            height: 60px;
            top: -20px;
            left: 30px;
        }

        .cloud::after {
            width: 40px;
            height: 40px;
            top: -15px;
            right: 30px;
        }

        /* Animation for clouds */
        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(1deg);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            header {
                flex-direction: column;
                gap: 20px;
            }
            
            .controls {
                justify-content: center;
            }
            
            .diary-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Sky Background -->
    <div id="sky"></div>
    <div class="stars" id="stars"></div>
    <div id="celestial-body"></div>

    <div class="container">
        <header>
            <div class="logo">
                <h1><i class="fas fa-cloud"></i> Cloud Diary</h1>
            </div>
            
            <div class="controls">
                <div class="time-controls">
                    <button class="time-btn active" data-time="dawn">Dawn</button>
                    <button class="time-btn" data-time="morning">Morning</button>
                    <button class="time-btn" data-time="noon">Noon</button>
                    <button class="time-btn" data-time="afternoon">Afternoon</button>
                    <button class="time-btn" data-time="dusk">Dusk</button>
                    <button class="time-btn" data-time="night">Night</button>
                    <button class="time-btn" data-time="midnight">Midnight</button>
                </div>
                
                <button class="btn" id="clearBtn">
                    <i class="fas fa-trash"></i> Clear All
                </button>
                <button class="btn" id="saveBtn">
                    <i class="fas fa-save"></i> Save Diary
                </button>
            </div>
        </header>
        
        <main class="main-content">
            <section class="diary-section">
                <h2 class="section-title"><i class="fas fa-pen"></i> Write Your Thoughts</h2>
                
                <textarea id="thoughtInput" placeholder="Write your thoughts here... They will become clouds in the sky. Try to keep it under 200 characters for best results." maxlength="200"></textarea>
                
                <div class="char-count">
                    <span id="charCount">0</span>/200 characters
                </div>
                
                <div class="mood-selector">
                    <div class="section-title" style="margin-bottom: 10px; font-size: 1.2rem;">
                        <i class="fas fa-smile"></i> Mood:
                    </div>
                    <button class="mood-btn active" data-mood="happy">üòä Happy</button>
                    <button class="mood-btn" data-mood="calm">üòå Calm</button>
                    <button class="mood-btn" data-mood="thoughtful">ü§î Thoughtful</button>
                    <button class="mood-btn" data-mood="dreamy">üåô Dreamy</button>
                    <button class="mood-btn" data-mood="sad">üò¢ Sad</button>
                    <button class="mood-btn" data-mood="excited">üéâ Excited</button>
                </div>
                
                <button class="btn" id="addCloudBtn" style="width: 100%; justify-content: center; background-color: #4a6fa5; color: white;">
                    <i class="fas fa-cloud-upload-alt"></i> Add to Sky
                </button>
                
                <div style="margin-top: 30px; font-size: 0.9rem; color: #666;">
                    <p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Drag clouds to arrange them. Click the edit button to modify a thought, or delete to remove it.</p>
                    <p style="margin-top: 10px;"><i class="fas fa-history"></i> Your thoughts are automatically saved in your browser.</p>
                </div>
            </section>
            
            <section class="clouds-section">
                <h2 class="section-title" style="color: white; padding: 20px; margin: 0;"><i class="fas fa-cloud"></i> Your Cloud Thoughts</h2>
                
                <div id="cloudsContainer">
                    <!-- Clouds will be added here dynamically -->
                    <div class="empty-clouds" id="emptyClouds">
                        <i class="fas fa-cloud"></i>
                        <p>Your thoughts will appear here as clouds</p>
                        <p>Write something and click "Add to Sky"</p>
                    </div>
                </div>
            </section>
        </main>
        
        <footer>
            <p>Cloud Diary ‚òÅÔ∏è | Write your thoughts and watch them float away | Made with <i class="fas fa-heart"></i></p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const sky = document.getElementById('sky');
            const stars = document.getElementById('stars');
            const celestialBody = document.getElementById('celestial-body');
            const thoughtInput = document.getElementById('thoughtInput');
            const charCount = document.getElementById('charCount');
            const addCloudBtn = document.getElementById('addCloudBtn');
            const clearBtn = document.getElementById('clearBtn');
            const saveBtn = document.getElementById('saveBtn');
            const cloudsContainer = document.getElementById('cloudsContainer');
            const emptyClouds = document.getElementById('emptyClouds');
            const timeButtons = document.querySelectorAll('.time-btn');
            const moodButtons = document.querySelectorAll('.mood-btn');
            
            // State
            let currentTime = 'noon';
            let currentMood = 'happy';
            let clouds = [];
            let nextCloudId = 1;
            let isDragging = false;
            let dragCloud = null;
            let dragOffsetX = 0;
            let dragOffsetY = 0;
            
            // Time of day settings
            const timeSettings = {
                dawn: {
                    gradient: 'var(--dawn-gradient)',
                    celestialColor: '#ff9966',
                    celestialPosition: { x: 20, y: 70 },
                    starOpacity: 0
                },
                morning: {
                    gradient: 'var(--morning-gradient)',
                    celestialColor: '#ffcc33',
                    celestialPosition: { x: 30, y: 50 },
                    starOpacity: 0
                },
                noon: {
                    gradient: 'var(--noon-gradient)',
                    celestialColor: '#ffff66',
                    celestialPosition: { x: 50, y: 30 },
                    starOpacity: 0
                },
                afternoon: {
                    gradient: 'var(--afternoon-gradient)',
                    celestialColor: '#ff9966',
                    celestialPosition: { x: 70, y: 40 },
                    starOpacity: 0
                },
                dusk: {
                    gradient: 'var(--dusk-gradient)',
                    celestialColor: '#ff6699',
                    celestialPosition: { x: 80, y: 60 },
                    starOpacity: 0.2
                },
                night: {
                    gradient: 'var(--night-gradient)',
                    celestialColor: '#f0f0f0',
                    celestialPosition: { x: 30, y: 40 },
                    starOpacity: 0.8
                },
                midnight: {
                    gradient: 'var(--midnight-gradient)',
                    celestialColor: '#cccccc',
                    celestialPosition: { x: 70, y: 50 },
                    starOpacity: 1
                }
            };
            
            // Mood settings
            const moodSettings = {
                happy: { color: '#fff9c4', emoji: 'üòä' },
                calm: { color: '#e3f2fd', emoji: 'üòå' },
                thoughtful: { color: '#f3e5f5', emoji: 'ü§î' },
                dreamy: { color: '#fce4ec', emoji: 'üåô' },
                sad: { color: '#e8eaf6', emoji: 'üò¢' },
                excited: { color: '#ffecb3', emoji: 'üéâ' }
            };
            
            // Initialize
            function init() {
                // Load saved clouds from localStorage
                loadClouds();
                
                // Set up event listeners
                setupEventListeners();
                
                // Set initial time of day
                setTimeOfDay('noon');
                
                // Create stars
                createStars();
                
                // Add sample clouds if no clouds exist
                if (clouds.length === 0) {
                    addSampleClouds();
                }
                
                // Update character count
                updateCharCount();
            }
            
            // Set up event listeners
            function setupEventListeners() {
                // Thought input
                thoughtInput.addEventListener('input', updateCharCount);
                
                // Add cloud button
                addCloudBtn.addEventListener('click', addCloud);
                
                // Clear all button
                clearBtn.addEventListener('click', clearAllClouds);
                
                // Save button
                saveBtn.addEventListener('click', saveDiary);
                
                // Time of day buttons
                timeButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const time = this.getAttribute('data-time');
                        setTimeOfDay(time);
                        
                        // Update active button
                        timeButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
                
                // Mood buttons
                moodButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const mood = this.getAttribute('data-mood');
                        setCurrentMood(mood);
                        
                        // Update active button
                        moodButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
                
                // Allow pressing Enter to add cloud (with Ctrl/Shift)
                thoughtInput.addEventListener('keydown', function(e) {
                    if ((e.ctrlKey || e.shiftKey) && e.key === 'Enter') {
                        addCloud();
                    }
                });
                
                // Drag and drop for clouds
                document.addEventListener('mousedown', startDrag);
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                
                // Touch events for mobile
                document.addEventListener('touchstart', startDragTouch);
                document.addEventListener('touchmove', dragTouch);
                document.addEventListener('touchend', stopDrag);
            }
            
            // Update character count
            function updateCharCount() {
                const length = thoughtInput.value.length;
                charCount.textContent = length;
                
                // Change color if approaching limit
                if (length > 180) {
                    charCount.style.color = '#ff6b6b';
                } else if (length > 150) {
                    charCount.style.color = '#ffa726';
                } else {
                    charCount.style.color = '#777';
                }
            }
            
            // Set time of day
            function setTimeOfDay(time) {
                currentTime = time;
                const settings = timeSettings[time];
                
                // Update sky gradient
                sky.style.background = settings.gradient;
                
                // Update celestial body (sun/moon)
                celestialBody.style.background = settings.celestialColor;
                celestialBody.style.left = `calc(${settings.celestialPosition.x}% - 40px)`;
                celestialBody.style.top = `calc(${settings.celestialPosition.y}% - 40px)`;
                
                // Update stars visibility
                stars.style.opacity = settings.starOpacity;
                
                // Save preference
                localStorage.setItem('cloudDiaryTime', time);
            }
            
            // Create stars for night sky
            function createStars() {
                const starsContainer = document.getElementById('stars');
                starsContainer.innerHTML = '';
                
                // Create 150 stars
                for (let i = 0; i < 150; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    
                    // Random position and size
                    const size = Math.random() * 3 + 1;
                    const x = Math.random() * 100;
                    const y = Math.random() * 100;
                    
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    star.style.left = `${x}%`;
                    star.style.top = `${y}%`;
                    
                    // Random opacity
                    star.style.opacity = Math.random() * 0.8 + 0.2;
                    
                    // Add twinkle animation
                    star.style.animation = `twinkle ${Math.random() * 5 + 3}s infinite alternate`;
                    
                    starsContainer.appendChild(star);
                }
            }
            
            // Set current mood
            function setCurrentMood(mood) {
                currentMood = mood;
            }
            
            // Add a new cloud
            function addCloud() {
                const text = thoughtInput.value.trim();
                
                if (text === '') {
                    alert('Please write something before adding a cloud!');
                    thoughtInput.focus();
                    return;
                }
                
                // Create cloud object
                const cloud = {
                    id: nextCloudId++,
                    text: text,
                    mood: currentMood,
                    timestamp: new Date().toLocaleString(),
                    position: {
                        x: Math.random() * 70 + 5, // 5-75%
                        y: Math.random() * 70 + 5  // 5-75%
                    },
                    rotation: Math.random() * 20 - 10 // -10 to 10 degrees
                };
                
                // Add to array
                clouds.push(cloud);
                
                // Save to localStorage
                saveClouds();
                
                // Create cloud element
                createCloudElement(cloud);
                
                // Clear input
                thoughtInput.value = '';
                updateCharCount();
                
                // Hide empty state
                emptyClouds.style.display = 'none';
            }
            
            // Create cloud element
            function createCloudElement(cloud) {
                const cloudEl = document.createElement('div');
                cloudEl.className = 'cloud';
                cloudEl.id = `cloud-${cloud.id}`;
                cloudEl.dataset.id = cloud.id;
                
                // Set position and rotation
                cloudEl.style.left = `${cloud.position.x}%`;
                cloudEl.style.top = `${cloud.position.y}%`;
                cloudEl.style.transform = `rotate(${cloud.rotation}deg)`;
                
                // Set background color based on mood
                const moodColor = moodSettings[cloud.mood].color;
                cloudEl.style.backgroundColor = moodColor;
                
                // Create pseudo-elements with same color
                const style = document.createElement('style');
                style.textContent = `
                    #cloud-${cloud.id}::before, #cloud-${cloud.id}::after {
                        background-color: ${moodColor};
                    }
                `;
                document.head.appendChild(style);
                
                // Cloud content
                cloudEl.innerHTML = `
                    <div class="cloud-content">${cloud.text}</div>
                    <div class="cloud-footer">
                        <div>
                            <span class="cloud-mood" style="background-color: rgba(0,0,0,0.05);">${moodSettings[cloud.mood].emoji} ${cloud.mood}</span>
                            <span style="margin-left: 10px;">${formatTime(cloud.timestamp)}</span>
                        </div>
                        <div class="cloud-controls">
                            <button class="cloud-btn edit-btn" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="cloud-btn delete-btn" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listeners to cloud buttons
                const editBtn = cloudEl.querySelector('.edit-btn');
                const deleteBtn = cloudEl.querySelector('.delete-btn');
                
                editBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    editCloud(cloud.id);
                });
                
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    deleteCloud(cloud.id);
                });
                
                // Add animation
                cloudEl.style.animation = `float ${Math.random() * 10 + 15}s infinite ease-in-out`;
                cloudEl.style.animationDelay = `${Math.random() * 5}s`;
                
                // Add to container
                cloudsContainer.appendChild(cloudEl);
            }
            
            // Edit cloud
            function editCloud(cloudId) {
                const cloud = clouds.find(c => c.id === cloudId);
                if (!cloud) return;
                
                // Fill input with cloud text
                thoughtInput.value = cloud.text;
                updateCharCount();
                
                // Set mood
                setCurrentMood(cloud.mood);
                moodButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('data-mood') === cloud.mood);
                });
                
                // Delete the cloud (will be re-added when user clicks "Add to Sky")
                deleteCloud(cloudId);
                
                // Scroll to input
                thoughtInput.focus();
            }
            
            // Delete cloud
            function deleteCloud(cloudId) {
                // Remove from array
                clouds = clouds.filter(c => c.id !== cloudId);
                
                // Remove from DOM
                const cloudEl = document.getElementById(`cloud-${cloudId}`);
                if (cloudEl) cloudEl.remove();
                
                // Save to localStorage
                saveClouds();
                
                // Show empty state if no clouds left
                if (clouds.length === 0) {
                    emptyClouds.style.display = 'block';
                }
            }
            
            // Clear all clouds
            function clearAllClouds() {
                if (clouds.length === 0) return;
                
                if (confirm('Are you sure you want to clear all your cloud thoughts?')) {
                    clouds = [];
                    cloudsContainer.innerHTML = '';
                    emptyClouds.style.display = 'block';
                    saveClouds();
                }
            }
            
            // Save diary (download as JSON)
            function saveDiary() {
                const data = {
                    clouds: clouds,
                    savedAt: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const url = URL.createObjectURL(dataBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cloud-diary-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Show feedback
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                setTimeout(() => {
                    saveBtn.innerHTML = originalText;
                }, 2000);
            }
            
            // Save clouds to localStorage
            function saveClouds() {
                const data = {
                    clouds: clouds,
                    nextCloudId: nextCloudId
                };
                localStorage.setItem('cloudDiaryData', JSON.stringify(data));
            }
            
            // Load clouds from localStorage
            function loadClouds() {
                const saved = localStorage.getItem('cloudDiaryData');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        clouds = data.clouds || [];
                        nextCloudId = data.nextCloudId || 1;
                        
                        // Restore saved time preference
                        const savedTime = localStorage.getItem('cloudDiaryTime');
                        if (savedTime && timeSettings[savedTime]) {
                            currentTime = savedTime;
                            timeButtons.forEach(btn => {
                                btn.classList.toggle('active', btn.getAttribute('data-time') === savedTime);
                            });
                        }
                        
                        // Create cloud elements
                        clouds.forEach(cloud => createCloudElement(cloud));
                        
                        // Hide empty state if we have clouds
                        if (clouds.length > 0) {
                            emptyClouds.style.display = 'none';
                        }
                    } catch (e) {
                        console.error('Error loading saved data:', e);
                    }
                }
            }
            
            // Add sample clouds for first-time users
            function addSampleClouds() {
                const sampleClouds = [
                    {
                        text: "Today was a beautiful day. I feel grateful for the little things.",
                        mood: "happy"
                    },
                    {
                        text: "I wonder what the future holds... Sometimes I get lost in my thoughts.",
                        mood: "thoughtful"
                    },
                    {
                        text: "Remember to breathe deeply and stay present in the moment.",
                        mood: "calm"
                    }
                ];
                
                // Add sample clouds with a delay for effect
                sampleClouds.forEach((cloudData, index) => {
                    setTimeout(() => {
                        const cloud = {
                            id: nextCloudId++,
                            text: cloudData.text,
                            mood: cloudData.mood,
                            timestamp: new Date().toLocaleString(),
                            position: {
                                x: Math.random() * 70 + 5,
                                y: Math.random() * 70 + 5
                            },
                            rotation: Math.random() * 20 - 10
                        };
                        
                        clouds.push(cloud);
                        createCloudElement(cloud);
                        
                        // Hide empty state after first cloud
                        if (index === 0) {
                            emptyClouds.style.display = 'none';
                        }
                    }, index * 500);
                });
                
                // Save after adding all samples
                setTimeout(saveClouds, sampleClouds.length * 500 + 500);
            }
            
            // Format time for display
            function formatTime(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 1) return "Just now";
                if (diffMins < 60) return `${diffMins}m ago`;
                if (diffHours < 24) return `${diffHours}h ago`;
                if (diffDays < 7) return `${diffDays}d ago`;
                
                return date.toLocaleDateString();
            }
            
            // Drag and drop functions
            function startDrag(e) {
                if (e.target.closest('.cloud')) {
                    isDragging = true;
                    dragCloud = e.target.closest('.cloud');
                    
                    const rect = dragCloud.getBoundingClientRect();
                    dragOffsetX = e.clientX - rect.left;
                    dragOffsetY = e.clientY - rect.top;
                    
                    dragCloud.style.animationPlayState = 'paused';
                    dragCloud.style.zIndex = '100';
                    e.preventDefault();
                }
            }
            
            function startDragTouch(e) {
                if (e.target.closest('.cloud')) {
                    isDragging = true;
                    dragCloud = e.target.closest('.cloud');
                    
                    const rect = dragCloud.getBoundingClientRect();
                    dragOffsetX = e.touches[0].clientX - rect.left;
                    dragOffsetY = e.touches[0].clientY - rect.top;
                    
                    dragCloud.style.animationPlayState = 'paused';
                    dragCloud.style.zIndex = '100';
                    e.preventDefault();
                }
            }
            
            function drag(e) {
                if (!isDragging || !dragCloud) return;
                
                const containerRect = cloudsContainer.getBoundingClientRect();
                let clientX, clientY;
                
                if (e.type === 'touchmove') {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                
                // Calculate new position in percentages
                const newX = ((clientX - containerRect.left - dragOffsetX) / containerRect.width) * 100;
                const newY = ((clientY - containerRect.top - dragOffsetY) / containerRect.height) * 100;
                
                // Constrain within container
                const constrainedX = Math.max(0, Math.min(newX, 95));
                const constrainedY = Math.max(0, Math.min(newY, 95));
                
                dragCloud.style.left = `${constrainedX}%`;
                dragCloud.style.top = `${constrainedY}%`;
                
                // Update cloud position in data
                const cloudId = parseInt(dragCloud.dataset.id);
                const cloud = clouds.find(c => c.id === cloudId);
                if (cloud) {
                    cloud.position.x = constrainedX;
                    cloud.position.y = constrainedY;
                    saveClouds();
                }
            }
            
            function dragTouch(e) {
                drag(e);
            }
            
            function stopDrag() {
                if (isDragging && dragCloud) {
                    dragCloud.style.animationPlayState = 'running';
                    dragCloud.style.zIndex = '1';
                }
                
                isDragging = false;
                dragCloud = null;
            }
            
            // CSS for star twinkling
            const style = document.createElement('style');
            style.textContent = `
                @keyframes twinkle {
                    0% { opacity: 0.2; }
                    100% { opacity: 0.8; }
                }
            `;
            document.head.appendChild(style);
            
            // Initialize the app
            init();
        });
    </script>
</body>
</html>