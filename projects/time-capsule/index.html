<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Capsule ¬∑ Messages to Future You</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        :root {
            --bg-gradient-start: #fdf8f2;
            --bg-gradient-end: #f0e9e1;
            --card-bg: rgba(255, 255, 255, 0.85);
            --card-bg-solid: #ffffff;
            --text-primary: #3a2c2c;
            --text-secondary: #6b5e5e;
            --text-light: #9b8b8b;
            --accent: #b48c8c;
            --accent-light: #d9c2c2;
            --accent-dark: #8e6e6e;
            --border: #e8d9d9;
            --shadow: 0 15px 35px rgba(0, 0, 0, 0.05);
            --shadow-hover: 0 25px 40px rgba(0, 0, 0, 0.08);
            --success: #9b9b7a;
            --success-light: #e3e3d3;
            --warm: #f3e3d3;
            --sand: #f5efe6;
            --paper: #fffbf7;
        }
        
        body {
            background: linear-gradient(145deg, var(--bg-gradient-start), var(--bg-gradient-end));
            color: var(--text-primary);
            min-height: 100vh;
            padding: 30px 20px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(180, 140, 140, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 70%, rgba(180, 140, 140, 0.05) 0%, transparent 30%),
                repeating-linear-gradient(45deg, rgba(180, 140, 140, 0.02) 0px, rgba(180, 140, 140, 0.02) 1px, transparent 1px, transparent 10px);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }
        
        header {
            text-align: center;
            padding: 20px 0 40px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            color: var(--accent);
            font-size: 3.2rem;
            filter: drop-shadow(0 4px 6px rgba(180, 140, 140, 0.2));
        }
        
        h1 {
            font-size: 3.4rem;
            font-weight: 500;
            letter-spacing: -0.5px;
            background: linear-gradient(to right, var(--accent-dark), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .tagline {
            color: var(--text-secondary);
            font-size: 1.3rem;
            font-weight: 300;
            max-width: 650px;
            margin: 0 auto;
            line-height: 1.6;
            font-style: italic;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 35px;
            margin-bottom: 50px;
        }
        
        @media (max-width: 1000px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .capsule-creator {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border-radius: 32px;
            padding: 35px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: all 0.2s ease;
        }
        
        .capsule-creator:hover {
            box-shadow: var(--shadow-hover);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .section-title {
            font-size: 1.8rem;
            font-weight: 500;
            margin-bottom: 25px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 2px solid var(--accent-light);
            padding-bottom: 15px;
        }
        
        .section-title i {
            color: var(--accent);
            font-size: 1.6rem;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 1rem;
            letter-spacing: 0.5px;
        }
        
        textarea, input {
            width: 100%;
            padding: 18px;
            background: var(--paper);
            border: 1.5px solid var(--border);
            border-radius: 20px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.2s;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.02);
        }
        
        textarea:focus, input:focus {
            outline: none;
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 4px rgba(180, 140, 140, 0.1);
        }
        
        textarea {
            min-height: 160px;
            resize: vertical;
            line-height: 1.7;
        }
        
        .date-picker {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .date-input {
            flex: 1;
            padding: 16px;
            background: var(--paper);
            border: 1.5px solid var(--border);
            border-radius: 18px;
            color: var(--text-primary);
            font-family: inherit;
        }
        
        .preset-dates {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            background: white;
            border: 1.5px solid var(--border);
            border-radius: 40px;
            padding: 10px 20px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .preset-btn:hover {
            background: var(--accent-light);
            border-color: var(--accent);
            color: white;
        }
        
        .preset-btn i {
            font-size: 0.9rem;
        }
        
        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 18px 28px;
            font-size: 1.1rem;
            border-radius: 40px;
            cursor: pointer;
            transition: all 0.25s;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin-top: 15px;
            border: 1px solid transparent;
        }
        
        .btn:hover {
            background: var(--accent-dark);
            transform: translateY(-3px);
            box-shadow: 0 12px 20px rgba(180, 140, 140, 0.25);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--accent);
            border: 2px solid var(--accent);
        }
        
        .btn-outline:hover {
            background: var(--accent);
            color: white;
        }
        
        .capsules-vault {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border-radius: 32px;
            padding: 35px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        
        .vault-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 25px;
        }
        
        .capsule-count {
            background: var(--accent-light);
            padding: 8px 20px;
            border-radius: 40px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .capsules-grid {
            display: flex;
            flex-direction: column;
            gap: 18px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .capsules-grid::-webkit-scrollbar {
            width: 6px;
        }
        
        .capsules-grid::-webkit-scrollbar-track {
            background: var(--accent-light);
            border-radius: 10px;
        }
        
        .capsules-grid::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }
        
        .capsule-card {
            background: white;
            border-radius: 24px;
            padding: 20px 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 1px solid var(--border);
            transition: all 0.2s;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.02);
        }
        
        .capsule-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 18px 25px rgba(0,0,0,0.05);
            border-color: var(--accent);
        }
        
        .capsule-icon {
            background: var(--warm);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--accent);
            flex-shrink: 0;
        }
        
        .capsule-icon.locked {
            color: var(--text-light);
            background: #f0f0f0;
        }
        
        .capsule-icon.unlocked {
            background: var(--success-light);
            color: var(--success);
        }
        
        .capsule-info {
            flex: 1;
        }
        
        .capsule-title {
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 6px;
            color: var(--text-primary);
        }
        
        .capsule-date {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 6px;
        }
        
        .capsule-preview {
            color: var(--text-light);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        
        .capsule-status {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .status-badge {
            padding: 6px 14px;
            border-radius: 40px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-locked {
            background: #f0f0f0;
            color: #9b8b8b;
        }
        
        .status-available {
            background: var(--success-light);
            color: var(--success);
        }
        
        .status-opened {
            background: #e8e8e8;
            color: #a0a0a0;
        }
        
        .unlock-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 18px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .unlock-btn:hover {
            background: var(--accent-dark);
            transform: scale(1.05);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 40px;
            padding: 45px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 30px 50px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.8);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-header h3 {
            font-size: 2rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.2s;
        }
        
        .close-modal:hover {
            color: var(--accent);
        }
        
        .message-content {
            background: var(--paper);
            padding: 30px;
            border-radius: 24px;
            border: 1px solid var(--border);
            line-height: 1.8;
            color: var(--text-primary);
            font-size: 1.1rem;
            margin-bottom: 25px;
            white-space: pre-wrap;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.02);
        }
        
        .meta-info {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            padding-top: 15px;
            border-top: 1px dashed var(--border);
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-light);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--accent-light);
        }
        
        .empty-state p {
            font-size: 1.2rem;
        }
        
        .time-travel-stats {
            background: var(--card-bg-solid);
            border-radius: 28px;
            padding: 25px 30px;
            display: flex;
            justify-content: space-around;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            flex-wrap: wrap;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--accent);
            line-height: 1.2;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        footer {
            text-align: center;
            padding: 40px 0 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-top: 1px solid var(--border);
            margin-top: 20px;
        }
        
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { bottom: 0; opacity: 0; }
            to { bottom: 30px; opacity: 1; }
        }
        
        @media (max-width: 700px) {
            h1 { font-size: 2.5rem; }
            .capsule-card { flex-direction: column; align-items: flex-start; }
            .capsule-status { align-items: flex-start; width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-hourglass-half logo-icon"></i>
                <h1>Time Capsule</h1>
            </div>
            <p class="tagline">Write letters to your future self. Preserve memories. Unlock them when the time is right.</p>
        </header>
        
        <div class="time-travel-stats">
            <div class="stat">
                <div class="stat-number" id="total-capsules-stat">0</div>
                <div class="stat-label">Total Capsules</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="sealed-stat">0</div>
                <div class="stat-label">Sealed</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="available-stat">0</div>
                <div class="stat-label">Ready to Open</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="opened-stat">0</div>
                <div class="stat-label">Opened</div>
            </div>
        </div>
        
        <div class="dashboard">
            <!-- Create New Capsule -->
            <div class="capsule-creator">
                <h2 class="section-title">
                    <i class="fas fa-pen-fancy"></i> Write to Future You
                </h2>
                
                <div class="input-group">
                    <label for="capsule-title">Title <span style="font-weight: normal; color: var(--text-light);">(optional)</span></label>
                    <input type="text" id="capsule-title" placeholder="e.g., Thoughts on my 30th birthday, Career goals 2026...">
                </div>
                
                <div class="input-group">
                    <label for="capsule-message">Your message <span style="color: #b48c8c;">*</span></label>
                    <textarea id="capsule-message" placeholder="Dear future me..."></textarea>
                </div>
                
                <div class="input-group">
                    <label for="capsule-date"><i class="fas fa-calendar-alt"></i> Open on</label>
                    <div class="date-picker">
                        <input type="date" id="capsule-date" class="date-input">
                    </div>
                    
                    <div class="preset-dates">
                        <button class="preset-btn" data-years="1"><i class="far fa-clock"></i> 1 year</button>
                        <button class="preset-btn" data-years="3"><i class="far fa-clock"></i> 3 years</button>
                        <button class="preset-btn" data-years="5"><i class="far fa-clock"></i> 5 years</button>
                        <button class="preset-btn" data-years="10"><i class="far fa-clock"></i> 10 years</button>
                    </div>
                </div>
                
                <button id="create-capsule" class="btn">
                    <i class="fas fa-hourglass-start"></i> Bury Time Capsule
                </button>
                <p style="color: var(--text-light); margin-top: 15px; font-size: 0.9rem; font-style: italic;">
                    <i class="fas fa-info-circle"></i> Your message will be encrypted until the unlock date.
                </p>
            </div>
            
            <!-- Vault of Capsules -->
            <div class="capsules-vault">
                <div class="vault-header">
                    <h2 class="section-title" style="border-bottom: none; padding-bottom: 0; margin-bottom: 0;">
                        <i class="fas fa-box"></i> Your Vault
                    </h2>
                    <span class="capsule-count" id="capsule-count">0 capsules</span>
                </div>
                
                <div id="capsules-list" class="capsules-grid">
                    <!-- Capsules will be dynamically inserted here -->
                    <div class="empty-state" id="empty-state-message">
                        <i class="fas fa-box-open"></i>
                        <p>Your time capsule vault is empty.</p>
                        <p style="font-size: 0.95rem; margin-top: 10px;">Write your first message to the future ‚ú®</p>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Time Capsule ‚Äî A gentle place for letters across time.</p>
            <p style="margin-top: 10px; opacity: 0.7;">Messages are stored locally in your browser. No servers, complete privacy.</p>
        </footer>
    </div>
    
    <!-- Modal for reading capsule -->
    <div id="capsule-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-capsule-title">Time Capsule</h3>
                <button class="close-modal" id="close-modal-btn">&times;</button>
            </div>
            <div id="modal-message" class="message-content">
                <!-- Message appears here -->
            </div>
            <div class="meta-info">
                <span id="modal-date">Sealed: ‚Äî</span>
                <span id="modal-unlock">Unlocked: now</span>
            </div>
        </div>
    </div>
    
    <!-- Toast notification -->
    <div id="toast" class="toast" style="display: none;"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ----- State -----
            let capsules = [];
            
            // DOM elements
            const titleInput = document.getElementById('capsule-title');
            const messageInput = document.getElementById('capsule-message');
            const dateInput = document.getElementById('capsule-date');
            const createBtn = document.getElementById('create-capsule');
            const capsulesList = document.getElementById('capsules-list');
            const emptyState = document.getElementById('empty-state-message');
            const totalCapsulesStat = document.getElementById('total-capsules-stat');
            const sealedStat = document.getElementById('sealed-stat');
            const availableStat = document.getElementById('available-stat');
            const openedStat = document.getElementById('opened-stat');
            const capsuleCountEl = document.getElementById('capsule-count');
            
            // Modal elements
            const modal = document.getElementById('capsule-modal');
            const modalTitle = document.getElementById('modal-capsule-title');
            const modalMessage = document.getElementById('modal-message');
            const modalDate = document.getElementById('modal-date');
            const modalUnlock = document.getElementById('modal-unlock');
            const closeModalBtn = document.getElementById('close-modal-btn');
            
            // Toast
            const toast = document.getElementById('toast');
            
            // Set default date to 1 year from now
            function setDefaultDate() {
                const today = new Date();
                const nextYear = new Date(today);
                nextYear.setFullYear(today.getFullYear() + 1);
                
                const year = nextYear.getFullYear();
                const month = String(nextYear.getMonth() + 1).padStart(2, '0');
                const day = String(nextYear.getDate()).padStart(2, '0');
                
                dateInput.value = `${year}-${month}-${day}`;
            }
            setDefaultDate();
            
            // ----- Load from localStorage -----
            function loadCapsules() {
                const stored = localStorage.getItem('timeCapsules');
                if (stored) {
                    try {
                        capsules = JSON.parse(stored);
                        // convert date strings back to Date objects for comparison
                        capsules.forEach(c => {
                            c.createdAt = new Date(c.createdAt);
                            c.unlockDate = new Date(c.unlockDate);
                        });
                    } catch (e) {
                        console.error('Failed to load capsules', e);
                        capsules = [];
                    }
                } else {
                    // Add sample capsule if empty
                    if (capsules.length === 0) {
                        const sampleDate = new Date();
                        sampleDate.setFullYear(sampleDate.getFullYear() + 2);
                        capsules.push({
                            id: generateId(),
                            title: 'Hello from the past',
                            message: 'I hope you\'re doing well. Remember to be kind to yourself. üåø',
                            unlockDate: sampleDate,
                            createdAt: new Date(),
                            opened: false
                        });
                    }
                }
                saveCapsules();
                renderCapsules();
                updateStats();
            }
            
            // ----- Save to localStorage -----
            function saveCapsules() {
                localStorage.setItem('timeCapsules', JSON.stringify(capsules));
                renderCapsules();
                updateStats();
            }
            
            // ----- Generate unique ID -----
            function generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substring(2);
            }
            
            // ----- Create new capsule -----
            function createCapsule() {
                const message = messageInput.value.trim();
                if (!message) {
                    showToast('Please write a message üíå', 'error');
                    return;
                }
                
                let unlockDate = dateInput.value ? new Date(dateInput.value) : null;
                
                if (!unlockDate) {
                    // fallback: 1 year from now
                    unlockDate = new Date();
                    unlockDate.setFullYear(unlockDate.getFullYear() + 1);
                }
                
                // Ensure unlock date is in the future
                const now = new Date();
                if (unlockDate <= now) {
                    showToast('Unlock date must be in the future ‚è≥', 'error');
                    return;
                }
                
                const title = titleInput.value.trim() || `Letter from ${now.toLocaleDateString()}`;
                
                const newCapsule = {
                    id: generateId(),
                    title: title,
                    message: message,
                    unlockDate: unlockDate,
                    createdAt: new Date(),
                    opened: false
                };
                
                capsules.push(newCapsule);
                saveCapsules();
                
                // Reset form
                titleInput.value = '';
                messageInput.value = '';
                setDefaultDate();
                
                showToast('‚ú® Time capsule buried successfully!');
            }
            
            // ----- Check if capsule is unlockable (date reached) -----
            function isUnlockable(capsule) {
                const now = new Date();
                return now >= capsule.unlockDate && !capsule.opened;
            }
            
            // ----- Unlock capsule (mark as opened) -----
            function unlockCapsule(id) {
                const capsule = capsules.find(c => c.id === id);
                if (capsule && !capsule.opened) {
                    capsule.opened = true;
                    saveCapsules();
                    showToast('üîì Time capsule opened. Welcome to the future.');
                    
                    // Show modal with the message
                    openCapsuleModal(capsule);
                }
            }
            
            // ----- Open modal to read capsule -----
            function openCapsuleModal(capsule) {
                modalTitle.textContent = capsule.title;
                modalMessage.textContent = capsule.message;
                
                const created = new Date(capsule.createdAt).toLocaleDateString('en-US', { 
                    year: 'numeric', month: 'long', day: 'numeric' 
                });
                modalDate.textContent = `üì¨ Sealed: ${created}`;
                
                const unlockedDate = new Date(capsule.unlockDate).toLocaleDateString('en-US', {
                    year: 'numeric', month: 'long', day: 'numeric'
                });
                
                if (capsule.opened) {
                    modalUnlock.textContent = `üîì Opened: ${new Date().toLocaleDateString()}`;
                } else {
                    modalUnlock.textContent = `üìÖ Unlocks: ${unlockedDate}`;
                }
                
                modal.style.display = 'flex';
            }
            
            // ----- Render all capsules in vault -----
            function renderCapsules() {
                // Sort: unread/unlockable first, then by date
                const sorted = [...capsules].sort((a, b) => {
                    // ready to open first
                    const aReady = isUnlockable(a);
                    const bReady = isUnlockable(b);
                    if (aReady && !bReady) return -1;
                    if (!aReady && bReady) return 1;
                    
                    // then by unlock date (soonest first)
                    return a.unlockDate - b.unlockDate;
                });
                
                if (sorted.length === 0) {
                    capsulesList.innerHTML = `
                        <div class="empty-state" id="empty-state-message">
                            <i class="fas fa-box-open"></i>
                            <p>Your time capsule vault is empty.</p>
                            <p style="font-size: 0.95rem; margin-top: 10px;">Write your first message to the future ‚ú®</p>
                        </div>
                    `;
                    capsuleCountEl.textContent = '0 capsules';
                    return;
                }
                
                let html = '';
                sorted.forEach(capsule => {
                    const now = new Date();
                    const unlockDate = new Date(capsule.unlockDate);
                    const isReady = now >= unlockDate && !capsule.opened;
                    const isOpened = capsule.opened;
                    
                    // Format dates
                    const formattedUnlock = unlockDate.toLocaleDateString('en-US', { 
                        month: 'short', day: 'numeric', year: 'numeric' 
                    });
                    
                    // Determine icon and status
                    let iconClass = 'fa-clock';
                    let iconBg = '';
                    let statusText = '';
                    let statusClass = '';
                    
                    if (isOpened) {
                        iconClass = 'fa-envelope-open';
                        iconBg = 'opened';
                        statusText = 'Opened';
                        statusClass = 'status-opened';
                    } else if (isReady) {
                        iconClass = 'fa-gift';
                        iconBg = 'unlocked';
                        statusText = 'Ready to open';
                        statusClass = 'status-available';
                    } else {
                        iconClass = 'fa-hourglass';
                        iconBg = 'locked';
                        statusText = `Unlocks ${formattedUnlock}`;
                        statusClass = 'status-locked';
                    }
                    
                    // Short preview
                    const preview = capsule.message.substring(0, 45) + (capsule.message.length > 45 ? '‚Ä¶' : '');
                    
                    html += `
                        <div class="capsule-card" data-id="${capsule.id}">
                            <div class="capsule-icon ${iconBg}">
                                <i class="fas ${iconClass}"></i>
                            </div>
                            <div class="capsule-info">
                                <div class="capsule-title">${capsule.title}</div>
                                <div class="capsule-date">
                                    <i class="far fa-calendar-alt"></i> Open: ${formattedUnlock}
                                </div>
                                <div class="capsule-preview">
                                    ${isOpened ? 'üìñ ' + preview : isReady ? 'üîî ' + preview : '‚è≥ ' + preview}
                                </div>
                            </div>
                            <div class="capsule-status">
                                <span class="status-badge ${statusClass}">${statusText}</span>
                                ${isReady ? `<button class="unlock-btn" data-id="${capsule.id}"><i class="fas fa-unlock-alt"></i> Open</button>` : ''}
                                ${isOpened ? `<button class="unlock-btn" style="background: #9b8b8b;" data-id="${capsule.id}"><i class="fas fa-book-open"></i> Read</button>` : ''}
                                ${!isReady && !isOpened ? `<button class="unlock-btn" style="background: #d9c2c2;" disabled><i class="fas fa-lock"></i> Locked</button>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                capsulesList.innerHTML = html;
                capsuleCountEl.textContent = `${capsules.length} ${capsules.length === 1 ? 'capsule' : 'capsules'}`;
                
                // Add event listeners to cards and buttons
                document.querySelectorAll('.capsule-card').forEach(card => {
                    const id = card.dataset.id;
                    
                    // Click on card opens if unlocked/opened, otherwise just info
                    card.addEventListener('click', (e) => {
                        // Prevent if clicking on button directly
                        if (e.target.closest('button')) return;
                        
                        const capsule = capsules.find(c => c.id === id);
                        if (capsule) {
                            if (capsule.opened || isUnlockable(capsule)) {
                                openCapsuleModal(capsule);
                            } else {
                                showToast('‚è≥ This capsule is still sealed. Time will tell.', 'info');
                            }
                        }
                    });
                });
                
                // Unlock/Read buttons
                document.querySelectorAll('.unlock-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const id = btn.dataset.id;
                        const capsule = capsules.find(c => c.id === id);
                        
                        if (capsule) {
                            if (!capsule.opened && isUnlockable(capsule)) {
                                unlockCapsule(id);
                            } else if (capsule.opened) {
                                openCapsuleModal(capsule);
                            }
                        }
                    });
                });
            }
            
            // ----- Update statistics -----
            function updateStats() {
                const total = capsules.length;
                const sealed = capsules.filter(c => !c.opened && new Date() < new Date(c.unlockDate)).length;
                const ready = capsules.filter(c => isUnlockable(c)).length;
                const opened = capsules.filter(c => c.opened).length;
                
                totalCapsulesStat.textContent = total;
                sealedStat.textContent = sealed;
                availableStat.textContent = ready;
                openedStat.textContent = opened;
            }
            
            // ----- Show toast notification -----
            function showToast(message, type = 'success') {
                toast.textContent = message;
                toast.style.display = 'flex';
                toast.style.background = type === 'error' ? '#c46f6f' : '#3a2c2c';
                toast.style.color = 'white';
                
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000);
            }
            
            // ----- Preset date buttons -----
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const years = parseInt(this.dataset.years, 10);
                    const date = new Date();
                    date.setFullYear(date.getFullYear() + years);
                    
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    
                    dateInput.value = `${year}-${month}-${day}`;
                });
            });
            
            // ----- Create button -----
            createBtn.addEventListener('click', createCapsule);
            
            // ----- Modal close -----
            function closeModal() {
                modal.style.display = 'none';
            }
            
            closeModalBtn.addEventListener('click', closeModal);
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // ----- Enter key in message (Ctrl+Enter) -----
            messageInput.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    createCapsule();
                }
            });
            
            // ----- Initialize -----
            loadCapsules();
            
            // Keyboard shortcut: Ctrl+Shift+T to create test capsule (dev)
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                    const testDate = new Date();
                    testDate.setSeconds(testDate.getSeconds() + 10); // opens in 10 seconds
                    
                    capsules.push({
                        id: generateId(),
                        title: '‚ö° Test Capsule',
                        message: 'This capsule will unlock in 10 seconds! Welcome, time traveler.',
                        unlockDate: testDate,
                        createdAt: new Date(),
                        opened: false
                    });
                    saveCapsules();
                    showToast('üß™ Test capsule added (unlocks in 10s)');
                }
            });
        });
    </script>
</body>
</html>