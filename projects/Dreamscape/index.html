<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dreamscape Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --bg-gradient-1: #0a0a1f;
            --bg-gradient-2: #1a1a3a;
            --bg-gradient-3: #2d1b69;
            --text-primary: #f0f0ff;
            --text-secondary: #b0b0ff;
            --accent: #9d4edd;
            --accent-light: #c77dff;
            --accent-dark: #7b2cbf;
            --dream-1: #ff6b9d;
            --dream-2: #4cc9f0;
            --dream-3: #f72585;
            --dream-4: #4361ee;
            --dream-5: #7209b7;
            --card-bg: rgba(26, 26, 58, 0.8);
            --border-color: rgba(157, 78, 221, 0.3);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-gradient-1), var(--bg-gradient-2), var(--bg-gradient-3));
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            color: var(--accent);
            font-size: 3.2rem;
            filter: drop-shadow(0 0 15px rgba(157, 78, 221, 0.7));
            animation: pulse 4s infinite alternate;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); filter: drop-shadow(0 0 15px rgba(157, 78, 221, 0.7)); }
            100% { transform: scale(1.1); filter: drop-shadow(0 0 25px rgba(199, 125, 255, 0.9)); }
        }
        
        h1 {
            font-size: 3.5rem;
            background: linear-gradient(to right, var(--accent-light), var(--dream-4), var(--dream-2));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .tagline {
            color: var(--text-secondary);
            font-size: 1.4rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1100px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .input-panel {
                order: 2;
            }
            
            .dreamscape-container {
                order: 1;
            }
        }
        
        .input-panel {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            height: fit-content;
        }
        
        .panel-section {
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title i {
            color: var(--accent);
        }
        
        .dream-input-container {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        textarea, select, input {
            width: 100%;
            padding: 16px;
            background: rgba(10, 10, 31, 0.7);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        textarea:focus, select:focus, input:focus {
            outline: none;
            border-color: var(--accent-light);
            box-shadow: 0 0 0 3px rgba(157, 78, 221, 0.2);
        }
        
        textarea {
            min-height: 180px;
            resize: vertical;
            line-height: 1.6;
        }
        
        .dream-type-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 15px;
        }
        
        .dream-type-btn {
            background: rgba(10, 10, 31, 0.7);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        .dream-type-btn:hover {
            background: rgba(30, 30, 70, 0.9);
            border-color: var(--accent);
            transform: translateY(-3px);
        }
        
        .dream-type-btn.active {
            background: var(--accent-dark);
            border-color: var(--accent-light);
            color: white;
        }
        
        .dream-type-btn i {
            font-size: 1.6rem;
        }
        
        .emotion-sliders {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 15px;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider-label {
            min-width: 120px;
            color: var(--text-secondary);
        }
        
        .slider {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(10, 10, 31, 0.7);
            border-radius: 4px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            border: 3px solid var(--accent-light);
        }
        
        .slider-value {
            min-width: 40px;
            text-align: center;
            color: var(--accent);
            font-weight: 600;
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-top: 15px;
        }
        
        .color-option {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.active {
            border-color: white;
            box-shadow: 0 0 15px white;
        }
        
        .btn {
            background: linear-gradient(to right, var(--accent), var(--accent-dark));
            color: white;
            border: none;
            padding: 18px 28px;
            font-size: 1.1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px rgba(157, 78, 221, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: rgba(10, 10, 31, 0.7);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            border-color: var(--accent);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.3);
        }
        
        .dreamscape-container {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 700px;
        }
        
        .dreamscape-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .dreamscape-title {
            font-size: 1.7rem;
            color: var(--text-primary);
        }
        
        .dreamscape-actions {
            display: flex;
            gap: 12px;
        }
        
        .dreamscape-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(10, 10, 31, 0.5);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        canvas {
            display: block;
            background: #050515;
            border-radius: 10px;
        }
        
        .dreamscape-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.2rem;
            width: 80%;
        }
        
        .placeholder-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
            color: var(--accent);
            opacity: 0.7;
        }
        
        .dream-library {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 40px;
        }
        
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .dream-card {
            background: rgba(10, 10, 31, 0.7);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .dream-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }
        
        .dream-card-title {
            font-size: 1.3rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dream-card-type {
            display: inline-block;
            padding: 5px 12px;
            background: rgba(157, 78, 221, 0.2);
            color: var(--accent);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .dream-card-text {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 0.95rem;
            flex: 1;
        }
        
        .dream-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .dream-card-emotions {
            display: flex;
            gap: 8px;
        }
        
        .emotion-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .dream-card-date {
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.85rem;
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            color: var(--text-secondary);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }
        
        .instructions {
            color: var(--text-secondary);
            margin-top: 20px;
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .dreamscape-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: rgba(10, 10, 31, 0.7);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 10px 20px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        .control-btn:hover {
            background: rgba(30, 30, 70, 0.9);
            border-color: var(--accent);
        }
        
        .control-btn.active {
            background: var(--accent-dark);
            border-color: var(--accent-light);
            color: white;
        }
        
        /* Animation for dream elements */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        @keyframes color-shift {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        /* Background stars */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .dreamscape-container {
                height: 500px;
            }
            
            .dream-type-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .library-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Background stars -->
    <div class="stars" id="stars"></div>
    
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-moon-stars logo-icon"></i>
                <h1>Dreamscape Generator</h1>
            </div>
            <p class="tagline">Transform your dreams into mesmerizing visual landscapes. Capture the essence of your subconscious mind in abstract animations.</p>
        </header>
        
        <div class="app-container">
            <div class="input-panel">
                <div class="panel-section">
                    <h3 class="section-title"><i class="fas fa-dream-catcher"></i> Your Dream</h3>
                    
                    <div class="dream-input-container">
                        <label for="dream-input"><i class="fas fa-pen-fancy"></i> Describe your dream:</label>
                        <textarea id="dream-input" placeholder="Describe your dream here... e.g., 'I was flying over a city made of crystals with two suns in the sky. I could hear music coming from the buildings below...'"></textarea>
                    </div>
                    
                    <div class="dream-input-container">
                        <label for="dream-title"><i class="fas fa-heading"></i> Dream Title (Optional):</label>
                        <input type="text" id="dream-title" placeholder="e.g., Crystal City Flight">
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3 class="section-title"><i class="fas fa-cloud-moon"></i> Dream Type</h3>
                    
                    <div class="dream-type-buttons">
                        <div class="dream-type-btn active" data-type="fantasy">
                            <i class="fas fa-dragon"></i>
                            <span>Fantasy</span>
                        </div>
                        <div class="dream-type-btn" data-type="adventure">
                            <i class="fas fa-hiking"></i>
                            <span>Adventure</span>
                        </div>
                        <div class="dream-type-btn" data-type="surreal">
                            <i class="fas fa-fish"></i>
                            <span>Surreal</span>
                        </div>
                        <div class="dream-type-btn" data-type="lucid">
                            <i class="fas fa-eye"></i>
                            <span>Lucid</span>
                        </div>
                        <div class="dream-type-btn" data-type="nightmare">
                            <i class="fas fa-skull-crossbones"></i>
                            <span>Nightmare</span>
                        </div>
                        <div class="dream-type-btn" data-type="memory">
                            <i class="fas fa-brain"></i>
                            <span>Memory</span>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3 class="section-title"><i class="fas fa-heart"></i> Dream Emotions</h3>
                    
                    <div class="emotion-sliders">
                        <div class="slider-container">
                            <span class="slider-label">Wonder/Awe</span>
                            <input type="range" min="0" max="100" value="50" class="slider" id="wonder-slider">
                            <span class="slider-value" id="wonder-value">50</span>
                        </div>
                        
                        <div class="slider-container">
                            <span class="slider-label">Fear/Anxiety</span>
                            <input type="range" min="0" max="100" value="20" class="slider" id="fear-slider">
                            <span class="slider-value" id="fear-value">20</span>
                        </div>
                        
                        <div class="slider-container">
                            <span class="slider-label">Joy/Excitement</span>
                            <input type="range" min="0" max="100" value="60" class="slider" id="joy-slider">
                            <span class="slider-value" id="joy-value">60</span>
                        </div>
                        
                        <div class="slider-container">
                            <span class="slider-label">Confusion</span>
                            <input type="range" min="0" max="100" value="40" class="slider" id="confusion-slider">
                            <span class="slider-value" id="confusion-value">40</span>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3 class="section-title"><i class="fas fa-palette"></i> Color Palette</h3>
                    
                    <div class="color-palette">
                        <div class="color-option active" style="background: linear-gradient(135deg, #9d4edd, #c77dff);" data-palette="dreamy"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #4361ee, #4cc9f0);" data-palette="ocean"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #ff6b9d, #f72585);" data-palette="passion"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #7209b7, #3a0ca3);" data-palette="mystic"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #f9c74f, #f8961e);" data-palette="sunset"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #2a9d8f, #e9c46a);" data-palette="earth"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #ff595e, #ffca3a);" data-palette="fire"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #8ac926, #1982c4);" data-palette="vibrant"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #6d6875, #b5838d);" data-palette="pastel"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #000814, #001d3d);" data-palette="midnight"></div>
                    </div>
                </div>
                
                <button id="generate-dreamscape" class="btn">
                    <i class="fas fa-crystal-ball"></i> Generate Dreamscape
                </button>
                
                <button id="save-dream" class="btn btn-secondary" style="margin-top: 15px;">
                    <i class="fas fa-save"></i> Save to Dream Library
                </button>
            </div>
            
            <div class="dreamscape-container">
                <div class="dreamscape-header">
                    <h2 class="dreamscape-title" id="dreamscape-title">Dreamscape Visualization</h2>
                    <div class="dreamscape-actions">
                        <button id="play-pause" class="control-btn">
                            <i class="fas fa-play"></i> Play
                        </button>
                        <button id="export-btn" class="control-btn">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button id="fullscreen-btn" class="control-btn">
                            <i class="fas fa-expand"></i> Fullscreen
                        </button>
                    </div>
                </div>
                
                <div class="dreamscape-wrapper">
                    <canvas id="dreamscape-canvas"></canvas>
                    
                    <div class="dreamscape-placeholder" id="dreamscape-placeholder">
                        <i class="fas fa-cloud-moon placeholder-icon"></i>
                        <h3>Your Dreamscape Awaits</h3>
                        <p>Describe your dream and click "Generate Dreamscape" to visualize it as an abstract animation.</p>
                    </div>
                </div>
                
                <div class="dreamscape-controls">
                    <button class="control-btn active" data-speed="slow">
                        <i class="fas fa-tachometer-alt-slow"></i> Slow
                    </button>
                    <button class="control-btn" data-speed="medium">
                        <i class="fas fa-tachometer-alt"></i> Medium
                    </button>
                    <button class="control-btn" data-speed="fast">
                        <i class="fas fa-tachometer-alt-fast"></i> Fast
                    </button>
                    <button class="control-btn" data-style="abstract">
                        <i class="fas fa-shapes"></i> Abstract
                    </button>
                    <button class="control-btn" data-style="fluid">
                        <i class="fas fa-water"></i> Fluid
                    </button>
                    <button class="control-btn active" data-style="particles">
                        <i class="fas fa-atom"></i> Particles
                    </button>
                </div>
                
                <p class="instructions">
                    <i class="fas fa-lightbulb"></i> The dreamscape visualizes emotions and themes from your dream as abstract shapes, colors, and movements.
                </p>
            </div>
        </div>
        
        <section class="dream-library">
            <h3 class="section-title"><i class="fas fa-book-open"></i> Dream Library</h3>
            <p style="color: var(--text-secondary); margin-bottom: 15px;">Your saved dreams. Click to visualize them again:</p>
            
            <div class="library-grid" id="dream-library-grid">
                <!-- Dream cards will be added here -->
                <div class="dream-card" id="sample-dream-1">
                    <div class="dream-card-title">
                        <span>Crystal City Flight</span>
                        <span class="dream-card-type">Fantasy</span>
                    </div>
                    <div class="dream-card-text">
                        Flying over a city made of shimmering crystals with two suns in the sky. Music echoed from the translucent buildings below as I soared between crystalline spires.
                    </div>
                    <div class="dream-card-footer">
                        <div class="dream-card-emotions">
                            <div class="emotion-dot" style="background-color: #9d4edd;"></div>
                            <div class="emotion-dot" style="background-color: #4cc9f0;"></div>
                            <div class="emotion-dot" style="background-color: #ff6b9d;"></div>
                        </div>
                        <div class="dream-card-date">Sample Dream</div>
                    </div>
                </div>
                
                <div class="dream-card" id="sample-dream-2">
                    <div class="dream-card-title">
                        <span>Ocean of Memories</span>
                        <span class="dream-card-type">Memory</span>
                    </div>
                    <div class="dream-card-text">
                        Swimming through an ocean where each wave contained a different memory from childhood. Familiar faces appeared in the water, speaking in echoes of past conversations.
                    </div>
                    <div class="dream-card-footer">
                        <div class="dream-card-emotions">
                            <div class="emotion-dot" style="background-color: #4361ee;"></div>
                            <div class="emotion-dot" style="background-color: #f9c74f;"></div>
                            <div class="emotion-dot" style="background-color: #2a9d8f;"></div>
                        </div>
                        <div class="dream-card-date">Sample Dream</div>
                    </div>
                </div>
                
                <div class="dream-card" id="sample-dream-3">
                    <div class="dream-card-title">
                        <span>Labyrinth of Whispers</span>
                        <span class="dream-card-type">Surreal</span>
                    </div>
                    <div class="dream-card-text">
                        Wandering through an endless maze where the walls whispered secrets in languages I didn't understand. The corridors shifted and changed with each turn, leading me deeper into confusion.
                    </div>
                    <div class="dream-card-footer">
                        <div class="dream-card-emotions">
                            <div class="emotion-dot" style="background-color: #7209b7;"></div>
                            <div class="emotion-dot" style="background-color: #ff595e;"></div>
                            <div class="emotion-dot" style="background-color: #8ac926;"></div>
                        </div>
                        <div class="dream-card-date">Sample Dream</div>
                    </div>
                </div>
            </div>
        </section>
        
        <footer>
            <p>Dreamscape Generator Â© 2023 | Visualize the language of your subconscious mind</p>
            <p style="margin-top: 10px; font-size: 0.8rem; color: rgba(255,255,255,0.5);">Dream analysis is for creative inspiration only, not psychological interpretation.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const dreamInput = document.getElementById('dream-input');
            const dreamTitleInput = document.getElementById('dream-title');
            const dreamTypeButtons = document.querySelectorAll('.dream-type-btn');
            const emotionSliders = document.querySelectorAll('.slider');
            const emotionValues = document.querySelectorAll('.slider-value');
            const colorOptions = document.querySelectorAll('.color-option');
            const generateBtn = document.getElementById('generate-dreamscape');
            const saveDreamBtn = document.getElementById('save-dream');
            const canvas = document.getElementById('dreamscape-canvas');
            const ctx = canvas.getContext('2d');
            const dreamscapePlaceholder = document.getElementById('dreamscape-placeholder');
            const dreamscapeTitle = document.getElementById('dreamscape-title');
            const playPauseBtn = document.getElementById('play-pause');
            const exportBtn = document.getElementById('export-btn');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const controlBtns = document.querySelectorAll('.control-btn');
            const dreamLibraryGrid = document.getElementById('dream-library-grid');
            const starsContainer = document.getElementById('stars');
            
            // Dreamscape state
            let isPlaying = false;
            let animationId = null;
            let currentDreamType = 'fantasy';
            let currentPalette = 'dreamy';
            let currentSpeed = 'medium';
            let currentStyle = 'particles';
            let dreams = [];
            let dreamElements = [];
            
            // Color palettes
            const palettes = {
                dreamy: ['#9d4edd', '#c77dff', '#ff6b9d', '#4cc9f0', '#f9c74f'],
                ocean: ['#4361ee', '#4cc9f0', '#4895ef', '#3a0ca3', '#7209b7'],
                passion: ['#ff6b9d', '#f72585', '#b5179e', '#560bad', '#480ca8'],
                mystic: ['#7209b7', '#3a0ca3', '#4361ee', '#4cc9f0', '#f72585'],
                sunset: ['#f9c74f', '#f8961e', '#f3722c', '#f9844a', '#90be6d'],
                earth: ['#2a9d8f', '#e9c46a', '#f4a261', '#e76f51', '#264653'],
                fire: ['#ff595e', '#ffca3a', '#8ac926', '#1982c4', '#6a4c93'],
                vibrant: ['#8ac926', '#1982c4', '#ff595e', '#ffca3a', '#6a4c93'],
                pastel: ['#6d6875', '#b5838d', '#e5989b', '#ffb4a2', '#ffcdb2'],
                midnight: ['#000814', '#001d3d', '#003566', '#ffc300', '#ffd60a']
            };
            
            // Dream types with characteristics
            const dreamTypes = {
                fantasy: { shapes: ['star', 'crystal', 'wing', 'crown'], movement: 'float', intensity: 0.7 },
                adventure: { shapes: ['mountain', 'path', 'compass', 'flag'], movement: 'linear', intensity: 0.8 },
                surreal: { shapes: ['blob', 'spiral', 'eye', 'hand'], movement: 'warp', intensity: 0.9 },
                lucid: { shapes: ['gear', 'eye', 'key', 'portal'], movement: 'controlled', intensity: 0.6 },
                nightmare: { shapes: ['spike', 'shadow', 'tear', 'crack'], movement: 'chaotic', intensity: 1.0 },
                memory: { shapes: ['cloud', 'wave', 'leaf', 'heart'], movement: 'gentle', intensity: 0.5 }
            };
            
            // Initialize stars background
            function initStars() {
                const starCount = 150;
                
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    
                    // Random size
                    const size = Math.random() * 3;
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    
                    // Random position
                    star.style.left = `${Math.random() * 100}vw`;
                    star.style.top = `${Math.random() * 100}vh`;
                    
                    // Random brightness and animation delay
                    const brightness = 0.3 + Math.random() * 0.7;
                    star.style.opacity = brightness;
                    const delay = Math.random() * 3;
                    star.style.animationDelay = `${delay}s`;
                    
                    starsContainer.appendChild(star);
                }
            }
            
            // Initialize canvas
            function initCanvas() {
                const container = canvas.parentElement;
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                
                // Clear canvas with dark background
                ctx.fillStyle = '#050515';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Show placeholder initially
                dreamscapePlaceholder.style.display = 'block';
            }
            
            // Update emotion value displays
            function updateEmotionValues() {
                emotionSliders.forEach((slider, index) => {
                    emotionValues[index].textContent = slider.value;
                });
            }
            
            // Generate dreamscape based on input
            function generateDreamscape() {
                const dreamText = dreamInput.value.trim();
                const title = dreamTitleInput.value.trim() || 'Untitled Dream';
                
                if (!dreamText) {
                    alert("Please describe your dream first.");
                    dreamInput.focus();
                    return;
                }
                
                // Hide placeholder
                dreamscapePlaceholder.style.display = 'none';
                
                // Update title
                dreamscapeTitle.textContent = title;
                
                // Get dream characteristics
                const dreamType = currentDreamType;
                const emotions = {
                    wonder: parseInt(document.getElementById('wonder-slider').value),
                    fear: parseInt(document.getElementById('fear-slider').value),
                    joy: parseInt(document.getElementById('joy-slider').value),
                    confusion: parseInt(document.getElementById('confusion-slider').value)
                };
                
                // Generate elements based on dream text
                generateDreamElements(dreamText, dreamType, emotions);
                
                // Start animation if not already playing
                if (!isPlaying) {
                    togglePlayPause();
                }
            }
            
            // Generate dream elements based on text analysis
            function generateDreamElements(text, dreamType, emotions) {
                dreamElements = [];
                
                const canvasWidth = canvas.width;
                const canvasHeight = canvas.height;
                const centerX = canvasWidth / 2;
                const centerY = canvasHeight / 2;
                
                // Get palette colors
                const palette = palettes[currentPalette] || palettes.dreamy;
                
                // Extract keywords and determine count
                const wordCount = text.split(' ').length;
                const elementCount = Math.min(30, Math.max(15, Math.floor(wordCount / 2)));
                
                // Get dream type characteristics
                const typeProps = dreamTypes[dreamType] || dreamTypes.fantasy;
                
                // Generate elements
                for (let i = 0; i < elementCount; i++) {
                    // Determine position
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 50 + Math.random() * (Math.min(canvasWidth, canvasHeight) / 2 - 60);
                    const x = centerX + distance * Math.cos(angle);
                    const y = centerY + distance * Math.sin(angle);
                    
                    // Determine size based on emotions
                    const emotionIntensity = (emotions.wonder + emotions.joy + emotions.fear + emotions.confusion) / 400;
                    const baseSize = 20 + typeProps.intensity * 15;
                    const size = baseSize + (Math.random() * 30 * emotionIntensity);
                    
                    // Determine shape
                    const shapeType = typeProps.shapes[Math.floor(Math.random() * typeProps.shapes.length)];
                    
                    // Determine color from palette
                    const colorIndex = Math.floor(Math.random() * palette.length);
                    let color = palette[colorIndex];
                    
                    // Adjust color based on emotions
                    if (emotions.fear > 70) {
                        color = blendColors(color, '#000000', 0.3);
                    }
                    if (emotions.joy > 70) {
                        color = blendColors(color, '#FFD700', 0.2);
                    }
                    
                    // Determine opacity
                    const opacity = 0.4 + Math.random() * 0.5;
                    
                    // Determine speed factor
                    const speedFactor = 0.5 + Math.random() * 1.5;
                    
                    // Create element
                    const element = {
                        x, y,
                        targetX: x,
                        targetY: y,
                        size,
                        shape: shapeType,
                        color,
                        opacity,
                        speedFactor,
                        angle: Math.random() * Math.PI * 2,
                        rotation: Math.random() * Math.PI * 2,
                        rotationSpeed: (Math.random() - 0.5) * 0.02,
                        pulsePhase: Math.random() * Math.PI * 2,
                        pulseSpeed: 0.02 + Math.random() * 0.03,
                        movementType: typeProps.movement,
                        offsetX: 0,
                        offsetY: 0,
                        age: 0,
                        lifespan: 200 + Math.random() * 300
                    };
                    
                    dreamElements.push(element);
                }
                
                // Add special elements based on keywords
                if (text.toLowerCase().includes('fly') || text.toLowerCase().includes('soar')) {
                    addSpecialElement('wing', centerX, centerY, 80, palette[0], 'float');
                }
                
                if (text.toLowerCase().includes('water') || text.toLowerCase().includes('ocean')) {
                    addSpecialElement('wave', centerX + 100, centerY - 50, 70, palette[1], 'gentle');
                    addSpecialElement('wave', centerX - 80, centerY + 40, 70, palette[1], 'gentle');
                }
                
                if (text.toLowerCase().includes('light') || text.toLowerCase().includes('bright')) {
                    addSpecialElement('star', centerX, centerY, 100, '#FFD700', 'pulse');
                }
                
                if (text.toLowerCase().includes('dark') || text.toLowerCase().includes('shadow')) {
                    addSpecialElement('shadow', centerX + 50, centerY + 50, 90, '#1a1a2e', 'chaotic');
                }
            }
            
            // Helper function to add special elements
            function addSpecialElement(shape, x, y, size, color, movement) {
                dreamElements.push({
                    x, y,
                    targetX: x,
                    targetY: y,
                    size,
                    shape,
                    color,
                    opacity: 0.7,
                    speedFactor: 0.8,
                    angle: Math.random() * Math.PI * 2,
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: (Math.random() - 0.5) * 0.01,
                    pulsePhase: Math.random() * Math.PI * 2,
                    pulseSpeed: 0.01,
                    movementType: movement,
                    offsetX: 0,
                    offsetY: 0,
                    age: 0,
                    lifespan: 400
                });
            }
            
            // Helper function to blend colors
            function blendColors(color1, color2, ratio) {
                // Parse hex colors
                const r1 = parseInt(color1.slice(1, 3), 16);
                const g1 = parseInt(color1.slice(3, 5), 16);
                const b1 = parseInt(color1.slice(5, 7), 16);
                
                const r2 = parseInt(color2.slice(1, 3), 16);
                const g2 = parseInt(color2.slice(3, 5), 16);
                const b2 = parseInt(color2.slice(5, 7), 16);
                
                // Blend
                const r = Math.round(r1 * (1 - ratio) + r2 * ratio);
                const g = Math.round(g1 * (1 - ratio) + g2 * ratio);
                const b = Math.round(b1 * (1 - ratio) + b2 * ratio);
                
                return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
            }
            
            // Animation loop
            function animate() {
                if (!isPlaying) return;
                
                // Clear canvas with gradient
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#050515');
                gradient.addColorStop(1, '#0a0a1f');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                // Draw dream elements
                dreamElements.forEach((element, index) => {
                    // Update element position based on movement type
                    updateElementPosition(element);
                    
                    // Draw the element
                    drawElement(element, centerX, centerY);
                    
                    // Age and remove old elements
                    element.age++;
                    if (element.age > element.lifespan) {
                        // Regenerate element
                        dreamElements[index] = regenerateElement(element);
                    }
                });
                
                // Draw special effects based on dream type
                drawDreamEffects(centerX, centerY);
                
                // Request next frame
                animationId = requestAnimationFrame(animate);
            }
            
            // Update element position based on movement type
            function updateElementPosition(element) {
                const speedFactor = getSpeedFactor();
                
                switch (element.movementType) {
                    case 'float':
                        element.offsetX = Math.sin(Date.now() * 0.001 * element.speedFactor * speedFactor) * 20;
                        element.offsetY = Math.cos(Date.now() * 0.001 * element.speedFactor * speedFactor) * 20;
                        break;
                        
                    case 'linear':
                        element.x += Math.sin(element.angle) * 0.5 * speedFactor;
                        element.y += Math.cos(element.angle) * 0.5 * speedFactor;
                        
                        // Wrap around canvas
                        if (element.x < 0) element.x = canvas.width;
                        if (element.x > canvas.width) element.x = 0;
                        if (element.y < 0) element.y = canvas.height;
                        if (element.y > canvas.height) element.y = 0;
                        break;
                        
                    case 'chaotic':
                        element.x += (Math.random() - 0.5) * 3 * speedFactor;
                        element.y += (Math.random() - 0.5) * 3 * speedFactor;
                        
                        // Keep within bounds
                        element.x = Math.max(20, Math.min(element.x, canvas.width - 20));
                        element.y = Math.max(20, Math.min(element.y, canvas.height - 20));
                        break;
                        
                    case 'gentle':
                        element.offsetX = Math.sin(Date.now() * 0.0005 * element.speedFactor * speedFactor) * 10;
                        element.offsetY = Math.cos(Date.now() * 0.0007 * element.speedFactor * speedFactor) * 10;
                        break;
                        
                    case 'warp':
                        element.x += Math.sin(element.age * 0.05) * 0.3 * speedFactor;
                        element.y += Math.cos(element.age * 0.03) * 0.3 * speedFactor;
                        break;
                        
                    case 'controlled':
                        // Move towards target
                        const dx = element.targetX - element.x;
                        const dy = element.targetY - element.y;
                        element.x += dx * 0.01 * speedFactor;
                        element.y += dy * 0.01 * speedFactor;
                        
                        // Randomly change target
                        if (Math.random() < 0.01) {
                            element.targetX = 50 + Math.random() * (canvas.width - 100);
                            element.targetY = 50 + Math.random() * (canvas.height - 100);
                        }
                        break;
                        
                    default:
                        // Default floating
                        element.offsetX = Math.sin(Date.now() * 0.001) * 10;
                        element.offsetY = Math.cos(Date.now() * 0.001) * 10;
                }
                
                // Update rotation
                element.rotation += element.rotationSpeed * speedFactor;
            }
            
            // Get speed factor based on current speed setting
            function getSpeedFactor() {
                switch (currentSpeed) {
                    case 'slow': return 0.5;
                    case 'fast': return 2.0;
                    default: return 1.0;
                }
            }
            
            // Regenerate element when it ages out
            function regenerateElement(oldElement) {
                const canvasWidth = canvas.width;
                const canvasHeight = canvas.height;
                const centerX = canvasWidth / 2;
                const centerY = canvasHeight / 2;
                
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * (Math.min(canvasWidth, canvasHeight) / 2 - 60);
                
                return {
                    ...oldElement,
                    x: centerX + distance * Math.cos(angle),
                    y: centerY + distance * Math.sin(angle),
                    targetX: centerX + distance * Math.cos(angle),
                    targetY: centerY + distance * Math.sin(angle),
                    age: 0,
                    rotation: Math.random() * Math.PI * 2,
                    pulsePhase: Math.random() * Math.PI * 2
                };
            }
            
            // Draw individual element based on shape
            function drawElement(element, centerX, centerY) {
                const x = element.x + element.offsetX;
                const y = element.y + element.offsetY;
                const size = element.size * (0.8 + 0.4 * Math.sin(element.pulsePhase + Date.now() * element.pulseSpeed));
                
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(element.rotation);
                ctx.globalAlpha = element.opacity;
                ctx.fillStyle = element.color;
                ctx.strokeStyle = blendColors(element.color, '#ffffff', 0.2);
                ctx.lineWidth = 2;
                
                switch (element.shape) {
                    case 'star':
                        drawStar(ctx, 0, 0, size / 2, size, 5);
                        ctx.fill();
                        break;
                        
                    case 'crystal':
                        drawPolygon(ctx, 0, 0, size / 2, 6);
                        ctx.fill();
                        break;
                        
                    case 'wing':
                        drawWing(ctx, 0, 0, size);
                        break;
                        
                    case 'wave':
                        drawWave(ctx, 0, 0, size);
                        break;
                        
                    case 'spiral':
                        drawSpiral(ctx, 0, 0, size);
                        break;
                        
                    case 'eye':
                        drawEye(ctx, 0, 0, size);
                        break;
                        
                    case 'shadow':
                        ctx.fillStyle = 'rgba(0,0,0,0.3)';
                        ctx.beginPath();
                        ctx.ellipse(0, 0, size/2, size/4, 0, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                        
                    case 'cloud':
                        drawCloud(ctx, 0, 0, size);
                        break;
                        
                    case 'heart':
                        drawHeart(ctx, 0, 0, size / 2);
                        ctx.fill();
                        break;
                        
                    case 'blob':
                        drawBlob(ctx, 0, 0, size / 2);
                        ctx.fill();
                        break;
                        
                    default:
                        // Default circle
                        ctx.beginPath();
                        ctx.arc(0, 0, size / 2, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.stroke();
                }
                
                ctx.restore();
            }
            
            // Draw star shape
            function drawStar(ctx, cx, cy, spikes, outerR, innerR) {
                let rot = Math.PI / 2 * 3;
                const step = Math.PI / spikes;
                
                ctx.beginPath();
                for (let i = 0; i < spikes; i++) {
                    const x = cx + Math.cos(rot) * outerR;
                    const y = cy + Math.sin(rot) * outerR;
                    ctx.lineTo(x, y);
                    rot += step;
                    
                    const x2 = cx + Math.cos(rot) * innerR;
                    const y2 = cy + Math.sin(rot) * innerR;
                    ctx.lineTo(x2, y2);
                    rot += step;
                }
                ctx.closePath();
            }
            
            // Draw polygon
            function drawPolygon(ctx, cx, cy, radius, sides) {
                ctx.beginPath();
                for (let i = 0; i < sides; i++) {
                    const angle = (i * 2 * Math.PI) / sides;
                    const x = cx + radius * Math.cos(angle);
                    const y = cy + radius * Math.sin(angle);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
            }
            
            // Draw wing shape
            function drawWing(ctx, cx, cy, size) {
                ctx.fillStyle = blendColors(currentColor || '#9d4edd', '#ffffff', 0.3);
                ctx.beginPath();
                ctx.moveTo(cx, cy - size / 2);
                ctx.quadraticCurveTo(cx + size, cy - size / 2, cx + size, cy);
                ctx.quadraticCurveTo(cx + size, cy + size / 2, cx, cy + size / 2);
                ctx.quadraticCurveTo(cx - size, cy + size / 2, cx - size, cy);
                ctx.quadraticCurveTo(cx - size, cy - size / 2, cx, cy - size / 2);
                ctx.fill();
                ctx.stroke();
            }
            
            // Draw wave shape
            function drawWave(ctx, cx, cy, size) {
                ctx.beginPath();
                for (let i = 0; i <= 5; i++) {
                    const x = cx - size/2 + (size * i / 5);
                    const y = cy + Math.sin(i * 0.8) * size/4;
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.strokeStyle = ctx.fillStyle;
                ctx.lineWidth = 3;
                ctx.stroke();
            }
            
            // Draw spiral
            function drawSpiral(ctx, cx, cy, size) {
                ctx.beginPath();
                for (let i = 0; i < 20; i++) {
                    const angle = i * 0.5;
                    const radius = i * 1.5;
                    const x = cx + Math.cos(angle) * radius;
                    const y = cy + Math.sin(angle) * radius;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.strokeStyle = ctx.fillStyle;
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            // Draw eye shape
            function drawEye(ctx, cx, cy, size) {
                ctx.beginPath();
                ctx.ellipse(cx, cy, size/2, size/4, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#000000';
                ctx.beginPath();
                ctx.ellipse(cx + size/8, cy, size/8, size/8, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.arc(cx + size/6, cy - size/16, size/20, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Draw cloud
            function drawCloud(ctx, cx, cy, size) {
                ctx.beginPath();
                ctx.arc(cx - size/4, cy, size/3, 0, Math.PI * 2);
                ctx.arc(cx + size/4, cy, size/3, 0, Math.PI * 2);
                ctx.arc(cx - size/8, cy - size/4, size/3, 0, Math.PI * 2);
                ctx.arc(cx + size/8, cy - size/4, size/3, 0, Math.PI * 2);
                ctx.arc(cx, cy, size/3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Draw heart
            function drawHeart(ctx, cx, cy, size) {
                ctx.beginPath();
                ctx.moveTo(cx, cy + size/4);
                ctx.bezierCurveTo(cx - size/2, cy - size/4, cx - size, cy + size/4, cx, cy + size);
                ctx.bezierCurveTo(cx + size, cy + size/4, cx + size/2, cy - size/4, cx, cy + size/4);
                ctx.closePath();
            }
            
            // Draw blob
            function drawBlob(ctx, cx, cy, radius) {
                const points = 8;
                ctx.beginPath();
                for (let i = 0; i < points; i++) {
                    const angle = (i * 2 * Math.PI) / points;
                    const variance = 0.7 + Math.random() * 0.6;
                    const x = cx + radius * Math.cos(angle) * variance;
                    const y = cy + radius * Math.sin(angle) * variance;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
            }
            
            // Draw dream effects
            function drawDreamEffects(centerX, centerY) {
                // Draw faint radial gradient from center
                const gradient = ctx.createRadialGradient(centerX, centerY, 50, centerX, centerY, canvas.width/2);
                gradient.addColorStop(0, 'rgba(157, 78, 221, 0.1)');
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw particles for certain styles
                if (currentStyle === 'particles') {
                    drawParticles(centerX, centerY);
                } else if (currentStyle === 'fluid') {
                    drawFluidEffect(centerX, centerY);
                } else if (currentStyle === 'abstract') {
                    drawAbstractEffect(centerX, centerY);
                }
            }
            
            // Draw particles
            function drawParticles(centerX, centerY) {
                const particleCount = 50;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                
                for (let i = 0; i < particleCount; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 100 + Math.random() * 200;
                    const x = centerX + Math.cos(angle + Date.now() * 0.0005) * distance;
                    const y = centerY + Math.sin(angle + Date.now() * 0.0005) * distance;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 1 + Math.random() * 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // Draw fluid effect
            function drawFluidEffect(centerX, centerY) {
                ctx.save();
                ctx.globalAlpha = 0.1;
                ctx.fillStyle = palettes[currentPalette][0] || '#9d4edd';
                
                for (let i = 0; i < 5; i++) {
                    const offset = Math.sin(Date.now() * 0.001 + i) * 20;
                    ctx.beginPath();
                    ctx.ellipse(centerX + i * 30 - 60, centerY + offset, 100, 40, 0, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                ctx.restore();
            }
            
            // Draw abstract effect
            function drawAbstractEffect(centerX, centerY) {
                ctx.save();
                ctx.globalAlpha = 0.05;
                ctx.fillStyle = palettes[currentPalette][1] || '#c77dff';
                
                for (let i = 0; i < 10; i++) {
                    const angle = (i / 10) * Math.PI * 2;
                    const x = centerX + Math.cos(angle + Date.now() * 0.0005) * 150;
                    const y = centerY + Math.sin(angle + Date.now() * 0.0005) * 150;
                    
                    ctx.beginPath();
                    ctx.rect(x - 40, y - 40, 80, 80);
                    ctx.fill();
                }
                
                ctx.restore();
            }
            
            // Toggle play/pause
            function togglePlayPause() {
                isPlaying = !isPlaying;
                
                if (isPlaying) {
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                    animate();
                } else {
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i> Play';
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                    }
                }
            }
            
            // Save dream to library
            function saveDream() {
                const dreamText = dreamInput.value.trim();
                if (!dreamText) {
                    alert("Please enter a dream to save.");
                    return;
                }
                
                const title = dreamTitleInput.value.trim() || 'Untitled Dream';
                const dreamType = currentDreamType;
                const emotions = {
                    wonder: document.getElementById('wonder-slider').value,
                    joy: document.getElementById('joy-slider').value,
                    fear: document.getElementById('fear-slider').value,
                    confusion: document.getElementById('confusion-slider').value
                };
                
                // Create dream card
                const dreamCard = document.createElement('div');
                dreamCard.className = 'dream-card';
                dreamCard.innerHTML = `
                    <div class="dream-card-title">
                        <span>${title}</span>
                        <span class="dream-card-type">${dreamType.charAt(0).toUpperCase() + dreamType.slice(1)}</span>
                    </div>
                    <div class="dream-card-text">${dreamText.substring(0, 100)}${dreamText.length > 100 ? '...' : ''}</div>
                    <div class="dream-card-footer">
                        <div class="dream-card-emotions">
                            <div class="emotion-dot" style="background-color: ${palettes[currentPalette][0]}"></div>
                            <div class="emotion-dot" style="background-color: ${palettes[currentPalette][1]}"></div>
                            <div class="emotion-dot" style="background-color: ${palettes[currentPalette][2]}"></div>
                        </div>
                        <div class="dream-card-date">${new Date().toLocaleDateString()}</div>
                    </div>
                `;
                
                // Add click event to load this dream
                dreamCard.addEventListener('click', function() {
                    dreamInput.value = dreamText;
                    dreamTitleInput.value = title;
                    
                    // Set dream type
                    dreamTypeButtons.forEach(btn => {
                        if (btn.dataset.type === dreamType) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                    
                    // Generate dreamscape
                    generateDreamscape();
                });
                
                // Add to library grid (remove sample if first save)
                const libraryGrid = document.getElementById('dream-library-grid');
                
                // Check if this is the first save - keep samples
                libraryGrid.appendChild(dreamCard);
                
                // Store in localStorage
                const savedDreams = JSON.parse(localStorage.getItem('dreams') || '[]');
                savedDreams.push({
                    title,
                    text: dreamText,
                    type: dreamType,
                    emotions,
                    palette: currentPalette,
                    date: new Date().toISOString()
                });
                
                // Keep only last 10 dreams
                if (savedDreams.length > 10) {
                    savedDreams.shift();
                }
                
                localStorage.setItem('dreams', JSON.stringify(savedDreams));
            }
            
            // Load saved dreams from localStorage
            function loadSavedDreams() {
                const savedDreams = JSON.parse(localStorage.getItem('dreams') || '[]');
                
                savedDreams.forEach(dream => {
                    const dreamCard = document.createElement('div');
                    dreamCard.className = 'dream-card';
                    dreamCard.innerHTML = `
                        <div class="dream-card-title">
                            <span>${dream.title}</span>
                            <span class="dream-card-type">${dream.type.charAt(0).toUpperCase() + dream.type.slice(1)}</span>
                        </div>
                        <div class="dream-card-text">${dream.text.substring(0, 100)}${dream.text.length > 100 ? '...' : ''}</div>
                        <div class="dream-card-footer">
                            <div class="dream-card-emotions">
                                <div class="emotion-dot" style="background-color: ${palettes[dream.palette][0]}"></div>
                                <div class="emotion-dot" style="background-color: ${palettes[dream.palette][1]}"></div>
                                <div class="emotion-dot" style="background-color: ${palettes[dream.palette][2]}"></div>
                            </div>
                            <div class="dream-card-date">${new Date(dream.date).toLocaleDateString()}</div>
                        </div>
                    `;
                    
                    dreamCard.addEventListener('click', function() {
                        dreamInput.value = dream.text;
                        dreamTitleInput.value = dream.title;
                        
                        // Set dream type
                        dreamTypeButtons.forEach(btn => {
                            if (btn.dataset.type === dream.type) {
                                btn.classList.add('active');
                            } else {
                                btn.classList.remove('active');
                            }
                        });
                        
                        // Set emotions
                        if (dream.emotions) {
                            document.getElementById('wonder-slider').value = dream.emotions.wonder || 50;
                            document.getElementById('fear-slider').value = dream.emotions.fear || 20;
                            document.getElementById('joy-slider').value = dream.emotions.joy || 60;
                            document.getElementById('confusion-slider').value = dream.emotions.confusion || 40;
                            updateEmotionValues();
                        }
                        
                        // Set palette
                        if (dream.palette) {
                            colorOptions.forEach(opt => {
                                if (opt.dataset.palette === dream.palette) {
                                    opt.classList.add('active');
                                } else {
                                    opt.classList.remove('active');
                                }
                            });
                            currentPalette = dream.palette;
                        }
                        
                        generateDreamscape();
                    });
                    
                    dreamLibraryGrid.appendChild(dreamCard);
                });
            }
            
            // Export dreamscape as image
            function exportDreamscape() {
                if (!isPlaying && dreamElements.length === 0) {
                    alert("Generate a dreamscape first!");
                    return;
                }
                
                // Create temporary canvas for export
                const exportCanvas = document.createElement('canvas');
                exportCanvas.width = canvas.width;
                exportCanvas.height = canvas.height;
                const exportCtx = exportCanvas.getContext('2d');
                
                // Draw current canvas state
                exportCtx.drawImage(canvas, 0, 0);
                
                // Create download link
                const link = document.createElement('a');
                link.download = `dreamscape-${Date.now()}.png`;
                link.href = exportCanvas.toDataURL('image/png');
                link.click();
            }
            
            // Toggle fullscreen
            function toggleFullscreen() {
                const container = canvas.parentElement;
                
                if (!document.fullscreenElement) {
                    container.requestFullscreen();
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> Exit';
                } else {
                    document.exitFullscreen();
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> Fullscreen';
                }
            }
            
            // Event Listeners
            
            // Dream type buttons
            dreamTypeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    dreamTypeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentDreamType = this.dataset.type;
                });
            });
            
            // Emotion sliders
            emotionSliders.forEach((slider, index) => {
                slider.addEventListener('input', function() {
                    emotionValues[index].textContent = this.value;
                });
            });
            
            // Color palette options
            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    colorOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    currentPalette = this.dataset.palette;
                });
            });
            
            // Generate button
            generateBtn.addEventListener('click', generateDreamscape);
            
            // Save dream button
            saveDreamBtn.addEventListener('click', saveDream);
            
            // Play/Pause button
            playPauseBtn.addEventListener('click', togglePlayPause);
            
            // Export button
            exportBtn.addEventListener('click', exportDreamscape);
            
            // Fullscreen button
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            
            // Control buttons (speed and style)
            controlBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    if (this.dataset.speed) {
                        // Speed buttons
                        document.querySelectorAll('[data-speed]').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        currentSpeed = this.dataset.speed;
                    } else if (this.dataset.style) {
                        // Style buttons
                        document.querySelectorAll('[data-style]').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        currentStyle = this.dataset.style;
                    }
                });
            });
            
            // Sample dream cards
            document.getElementById('sample-dream-1')?.addEventListener('click', function() {
                dreamInput.value = "Flying over a city made of shimmering crystals with two suns in the sky. Music echoed from the translucent buildings below as I soared between crystalline spires.";
                dreamTitleInput.value = "Crystal City Flight";
                
                // Set dream type
                dreamTypeButtons.forEach(btn => {
                    if (btn.dataset.type === 'fantasy') {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                currentDreamType = 'fantasy';
                
                // Set emotions
                document.getElementById('wonder-slider').value = 90;
                document.getElementById('fear-slider').value = 20;
                document.getElementById('joy-slider').value = 85;
                document.getElementById('confusion-slider').value = 30;
                updateEmotionValues();
                
                // Set palette
                colorOptions.forEach(opt => {
                    if (opt.dataset.palette === 'dreamy') {
                        opt.classList.add('active');
                    } else {
                        opt.classList.remove('active');
                    }
                });
                currentPalette = 'dreamy';
                
                generateDreamscape();
            });
            
            document.getElementById('sample-dream-2')?.addEventListener('click', function() {
                dreamInput.value = "Swimming through an ocean where each wave contained a different memory from childhood. Familiar faces appeared in the water, speaking in echoes of past conversations.";
                dreamTitleInput.value = "Ocean of Memories";
                
                dreamTypeButtons.forEach(btn => {
                    if (btn.dataset.type === 'memory') {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                currentDreamType = 'memory';
                
                document.getElementById('wonder-slider').value = 75;
                document.getElementById('fear-slider').value = 25;
                document.getElementById('joy-slider').value = 70;
                document.getElementById('confusion-slider').value = 50;
                updateEmotionValues();
                
                colorOptions.forEach(opt => {
                    if (opt.dataset.palette === 'ocean') {
                        opt.classList.add('active');
                    } else {
                        opt.classList.remove('active');
                    }
                });
                currentPalette = 'ocean';
                
                generateDreamscape();
            });
            
            document.getElementById('sample-dream-3')?.addEventListener('click', function() {
                dreamInput.value = "Wandering through an endless maze where the walls whispered secrets in languages I didn't understand. The corridors shifted and changed with each turn, leading me deeper into confusion.";
                dreamTitleInput.value = "Labyrinth of Whispers";
                
                dreamTypeButtons.forEach(btn => {
                    if (btn.dataset.type === 'surreal') {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                currentDreamType = 'surreal';
                
                document.getElementById('wonder-slider').value = 60;
                document.getElementById('fear-slider').value = 80;
                document.getElementById('joy-slider').value = 30;
                document.getElementById('confusion-slider').value = 90;
                updateEmotionValues();
                
                colorOptions.forEach(opt => {
                    if (opt.dataset.palette === 'mystic') {
                        opt.classList.add('active');
                    } else {
                        opt.classList.remove('active');
                    }
                });
                currentPalette = 'mystic';
                
                generateDreamscape();
            });
            
            // Handle window resize
            window.addEventListener('resize', function() {
                const wasPlaying = isPlaying;
                
                // Pause animation during resize
                if (isPlaying) {
                    isPlaying = false;
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                    }
                }
                
                // Reinitialize canvas
                initCanvas();
                

            </script>
            </body>
            </html>